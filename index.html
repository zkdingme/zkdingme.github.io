<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="丁星乐、学习、工作、生活" />
   
  <meta name="description" content="分享丁星乐的学习、工作与享乐时光" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     丁星乐
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/dingzhenkai"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover.jpg" alt="image frame" />
    </div>
    <div style="color:#000" class="cover-inner text-center text-white">
      <h1><a style="color:#000" href="/">丁星乐</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>


<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-magisk-install" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/08/13/magisk-install/"
    >magisk初探</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/08/13/magisk-install/" class="article-date">
  <time datetime="2021-08-13T02:47:28.000Z" itemprop="datePublished">2021-08-13</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>本文记录笔者在小米6(sagit)上刷入magisk并使用的过程。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>参照<a href="https://topjohnwu.github.io/Magisk/install.html" target="_blank" rel="noopener">作者写的安装教程</a>。</p>
<p>注意：刷入patch后的boot.img后还需要继续安装magisk manager才算完成， <a href="https://sspai.com/post/53043" target="_blank" rel="noopener">参考</a>。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>由于它是通过启动时在 boot 中创建钩子，把 /data/magisk.img 挂载到 /magisk，构建出一个在 system 基础上能够自定义替换，增加以及删除的文件系统，所有操作都在启动的时候完成，实际上并没有对 /system 分区进行修改（即 systemless 接口，以不触动 /system 的方式修改 /system）。</p>
<p>重新mount一个新的文件系统</p>
<p><strong>mount了哪些分区，APP安装在真实分区还是mount的新分区，APP运行时生成文件是在哪个分区</strong></p>
<p>mount 了cache data persist sepolicy.rules system vendor在/sbin/.magisk/mirror下面</p>
<p>data.img 被mount了两次，一次在/data，一次在/sbin/.magisk/mirror/data/</p>
<p>所以我adb install一个apk，同时写了/data/app 和 /sbin/.magisk/mirror/data/app</p>
<h3 id="获取ROOT原理"><a href="#获取ROOT原理" class="headerlink" title="获取ROOT原理"></a>获取ROOT原理</h3><h2 id="MagiskHide原理"><a href="#MagiskHide原理" class="headerlink" title="MagiskHide原理"></a>MagiskHide原理</h2><h2 id="如何检测Magisk-及-Magisk-ROOT"><a href="#如何检测Magisk-及-Magisk-ROOT" class="headerlink" title="如何检测Magisk 及 Magisk ROOT"></a>如何检测Magisk 及 Magisk ROOT</h2>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/08/13/magisk-install/" data-id="ckse37dnb002golj525tx5g1h"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/magisk/" rel="tag">magisk</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-java-printf" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/08/02/java-printf/"
    >java格式化输出</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/08/02/java-printf/" class="article-date">
  <time datetime="2021-08-02T07:21:54.000Z" itemprop="datePublished">2021-08-02</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="System-out-format-System-out-printf"><a href="#System-out-format-System-out-printf" class="headerlink" title="System.out.format System.out.printf"></a>System.out.format System.out.printf</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(<span class="string">"Alex has a %d-year-old son named %s, who is %.2f cm tall.\n"</span>, <span class="number">12</span>, <span class="string">"Tom"</span>, <span class="number">123.123</span>d);</span><br><span class="line"><span class="comment">// Alex has a 12-year-old son named Tom, who is 123.12 cm tall.</span></span><br><span class="line">System.out.format(<span class="string">"Alex has a %d-year-old son named %s, who is %2e cm tall.\n"</span>, <span class="number">12</span>, <span class="string">"Tom"</span>, <span class="number">123.123</span>d);</span><br><span class="line"><span class="comment">// Alex has a 12-year-old son named Tom, who is 1.231230e+02 cm tall.</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">Character</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">%</td>
<td align="center">Prints a literal % character (this type doesn’t accept any flags, width, precision, length fields).</td>
</tr>
<tr>
<td align="center">d, i</td>
<td align="center">int as a signed <a href="https://en.wikipedia.org/wiki/Integer" target="_blank" rel="noopener">integer</a>. %d and %i are synonymous for output, but are different when used with <code>scanf</code> for input (where using %i will interpret a number as hexadecimal if it’s preceded by 0x, and octal if it’s preceded by 0.)</td>
</tr>
<tr>
<td align="center">u</td>
<td align="center">Print decimal unsigned int.</td>
</tr>
<tr>
<td align="center">f, F</td>
<td align="center">double in normal (<a href="https://en.wikipedia.org/wiki/Fixed-point_arithmetic" target="_blank" rel="noopener">fixed-point</a>) notation. f and F only differs in how the strings for an infinite number or NaN are printed (inf, infinity and nan for f; INF, INFINITY and NAN for F).</td>
</tr>
<tr>
<td align="center">e, E</td>
<td align="center">double value in standard form (<em>d</em>.<em>ddd<em>e±</em>dd</em>). An E conversion uses the letter E (rather than e) to introduce the exponent. The exponent always contains at least two digits; if the value is zero, the exponent is 00. In Windows, the exponent contains three digits by default, e.g. 1.5e002, but this can be altered by Microsoft-specific <code>_set_output_format</code> function.</td>
</tr>
<tr>
<td align="center">g, G</td>
<td align="center">double in either normal or exponential notation, whichever is more appropriate for its magnitude. g uses lower-case letters, G uses upper-case letters. This type differs slightly from fixed-point notation in that insignificant zeroes to the right of the decimal point are not included. Also, the decimal point is not included on whole numbers.</td>
</tr>
<tr>
<td align="center">x, X</td>
<td align="center">unsigned int as a <a href="https://en.wikipedia.org/wiki/Hexadecimal" target="_blank" rel="noopener">hexadecimal</a> number. x uses lower-case letters and X uses upper-case.</td>
</tr>
<tr>
<td align="center">o</td>
<td align="center">unsigned int in octal.</td>
</tr>
<tr>
<td align="center">s</td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Null-terminated_string" target="_blank" rel="noopener">null-terminated string</a>.</td>
</tr>
<tr>
<td align="center">c</td>
<td align="center">char (character).</td>
</tr>
<tr>
<td align="center">p</td>
<td align="center">void* (pointer to void) in an implementation-defined format.</td>
</tr>
<tr>
<td align="center">a, A</td>
<td align="center">double in hexadecimal notation, starting with 0x or 0X. a uses lower-case letters, A uses upper-case letters.<a href="https://en.wikipedia.org/wiki/Printf_format_string#cite_note-5" target="_blank" rel="noopener">[5]</a><a href="https://en.wikipedia.org/wiki/Printf_format_string#cite_note-6" target="_blank" rel="noopener">[6]</a> (C++11 iostreams have a hexfloat that works the same).</td>
</tr>
<tr>
<td align="center">n</td>
<td align="center">Print nothing, but writes the number of characters written so far into an integer pointer parameter. In Java this prints a newline.<a href="https://en.wikipedia.org/wiki/Printf_format_string#cite_note-7" target="_blank" rel="noopener">[7]</a></td>
</tr>
</tbody></table>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/08/02/java-printf/" data-id="ckse37dn80024olj5a0bma9x4"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-java-modulo" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/08/02/java-modulo/"
    >java取模与取余运算</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/08/02/java-modulo/" class="article-date">
  <time datetime="2021-08-02T06:58:42.000Z" itemprop="datePublished">2021-08-02</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>先看几个java 取模的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 % 10 : 1 &#x2F;&#x2F; 1 &#x3D; 0 * 10 + 1</span><br><span class="line">11 % 10 : 1 &#x2F;&#x2F; 11 &#x3D; 1 * 10 + 1</span><br><span class="line">-1 % 10 : -1 &#x2F;&#x2F; -1 &#x3D; 0 * 10 + (-1)</span><br><span class="line">-11 % 10 : -1 &#x2F;&#x2F; -11 &#x3D; -1 * 10 + (-1)</span><br></pre></td></tr></table></figure>

<p>问题的关键在于对负数的处理</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/08/02/java-modulo/" data-id="ckse37dn6001yolj53yzk9ngv"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-elf-format" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/14/elf-format/"
    >elf 格式简介</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/07/14/elf-format/" class="article-date">
  <time datetime="2021-07-14T11:23:49.000Z" itemprop="datePublished">2021-07-14</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="1-elf是什么"><a href="#1-elf是什么" class="headerlink" title="1. elf是什么"></a>1. elf是什么</h2><p>维基百科介绍如下：</p>
<blockquote>
<p><strong>可执行与可链接格式</strong> （英语：Executable and Linkable Format，缩写为ELF），常被称为<strong>ELF格式</strong>，在<a href="https://zh.wikipedia.org/wiki/電腦科學" target="_blank" rel="noopener">计算机科学</a>中，是一种用于<a href="https://zh.wikipedia.org/wiki/執行檔" target="_blank" rel="noopener">可执行文件</a>、<a href="https://zh.wikipedia.org/wiki/目的檔" target="_blank" rel="noopener">目标文件</a>、<a href="https://zh.wikipedia.org/wiki/共享库" target="_blank" rel="noopener">共享库</a>和核心转储(core dump)的标准<a href="https://zh.wikipedia.org/wiki/檔案格式" target="_blank" rel="noopener">文件格式</a>。</p>
</blockquote>
<p>Linux 中</p>
<p>例如Linux中可执行文件ls, grep之类的，或者共享库libc.so 都是elf格式。</p>
<h2 id="2-elf文件格式是什么样的，有图吗"><a href="#2-elf文件格式是什么样的，有图吗" class="headerlink" title="2. elf文件格式是什么样的，有图吗"></a>2. elf文件格式是什么样的，有图吗</h2><p><img src="elf-format.png" alt=""></p>
<ul>
<li><p>ELF header：在文件的开始，描述整个文件的组织。</p>
</li>
<li><p>Program header table：告诉系统如何创建进程映像。用来构造进程映像的目标文件必须具有程序头部表，可重定位文件不需要这个表。</p>
</li>
<li><p>Section header table ：包含了描述文件节区的信息，每个节区在表中都有一项，每一项给出诸如节区名称、节区大小这类信息。用于链接的目标文件必须包含节区头部表，其他目标文件可以有，也可以没有这个表。</p>
</li>
<li><p>sections 或者 segments：segments是从运行的角度来描述elf文件，sections是从链接的角度来描述elf文件，也就是说，在链接阶段，我们可以忽略program header table来处理此文件，在运行阶段可以忽略section header table来处理此程序（所以很多加固手段删除了section header table）。注意：segments与sections是包含的关系，一个segment包含若干个section。</p>
</li>
</ul>
<p><strong>Section 有哪些</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>; <span class="comment">// .data</span></span><br><span class="line"><span class="keyword">char</span> *p1; <span class="comment">// .bss</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="keyword">int</span> b; <span class="comment">// 栈</span></span><br><span class="line"><span class="keyword">char</span> s[] = <span class="string">"abc"</span>; <span class="comment">// 栈</span></span><br><span class="line"><span class="keyword">char</span> *p2; <span class="comment">// 栈</span></span><br><span class="line"><span class="keyword">char</span> *p3 = <span class="string">"123456"</span>; <span class="comment">// p3 在栈上, "123456" 在 rodata</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> c =<span class="number">0</span>; <span class="comment">// .data</span></span><br><span class="line">p1 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">10</span>); </span><br><span class="line">p2 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">20</span>); </span><br><span class="line"><span class="comment">// 分配得来得10和20字节的区域就在堆区。 </span></span><br><span class="line"><span class="built_in">strcpy</span>(p1, <span class="string">"123456"</span>); <span class="comment">// 123456放在常量区，编译器可能会将它与p3所指向的"123456"优化成一个地方。 </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"hello shouwangxiansheng\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>.bss </p>
<p>未初始化的全局变量和静态变量，初始化为0的全局变量和静态变量也在.bss，如果数据全是零，为了优化考虑，编译器把它当作bss处理</p>
<p>.bss 段不占elf文件空间，其内容由操作系统初始化，统一初始化为0 .bss类型的全局变量只占运行时的内存空间，而不占文件空间</p>
</li>
<li><p>.comment </p>
<p>一些版本信息</p>
</li>
<li><p>.data .data1 </p>
<p>静态初始化(非零)的数据，所以有初值的全局变量和static变量在data区</p>
</li>
<li><p>.debug </p>
</li>
<li><p>.dynamic </p>
</li>
<li><p>.dynstr </p>
</li>
<li><p>.dynsym </p>
</li>
<li><p>.fini </p>
</li>
<li><p>.got </p>
<p>外部变量引用的地址</p>
</li>
<li><p>.hash </p>
</li>
<li><p>.init </p>
</li>
<li><p>.interp </p>
</li>
<li><p>.line </p>
</li>
<li><p>.note </p>
</li>
<li><p>.plt </p>
</li>
<li><p>.plt.got</p>
<p>外部函数引用的地址</p>
<p><a href="https://gtoad.github.io/2018/07/05/Android-Native-Hook/" target="_blank" rel="noopener">https://gtoad.github.io/2018/07/05/Android-Native-Hook/</a></p>
</li>
<li><p>.relname</p>
</li>
<li><p>.relaname </p>
</li>
<li><p>.rodata .rodata1 </p>
<p>存放常量</p>
<p>用const修饰的变量放在 rodata 里，字符串默认就是常量, #define定义的常量</p>
<p>const修饰的全局变量在常量区；const修饰的局部变量只是为了防止修改，没有放入常量区</p>
<p><a href="https://blog.csdn.net/laiqun_ai/article/details/8528366" target="_blank" rel="noopener">https://blog.csdn.net/laiqun_ai/article/details/8528366</a></p>
</li>
<li><p>.shstrtab </p>
</li>
<li><p>.strtab </p>
</li>
<li><p>.symtab </p>
</li>
<li><p>.text</p>
<p>代码</p>
</li>
</ul>
<h2 id="3-查看elf文件常用命令"><a href="#3-查看elf文件常用命令" class="headerlink" title="3. 查看elf文件常用命令"></a>3. 查看elf文件常用命令</h2><p>为方便理解，建议自己生成elf文件，然后分析。</p>
<p><code>touch hw.c</code> 然后<code>vim hw,c</code>输入上文例子:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> elf_test_a = <span class="number">-1</span>; <span class="comment">// .data</span></span><br><span class="line"><span class="keyword">char</span> *elf_test_p1; <span class="comment">// .bss</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="keyword">int</span> elf_test_b; <span class="comment">// 栈</span></span><br><span class="line"><span class="keyword">char</span> elf_test_s[] = <span class="string">"abc"</span>; <span class="comment">// 栈</span></span><br><span class="line"><span class="keyword">char</span> *elf_test_p2; <span class="comment">// 栈</span></span><br><span class="line"><span class="keyword">char</span> *elf_test_p3 = <span class="string">"123456"</span>; <span class="comment">// p3 在栈上, "123456" 在 rodata</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> elf_test_c = <span class="number">-1</span>; <span class="comment">// .data</span></span><br><span class="line">elf_test_p1 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">10</span>); </span><br><span class="line">elf_test_p2 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">20</span>); </span><br><span class="line"><span class="comment">// 分配得来得10和20字节的区域就在堆区。 </span></span><br><span class="line"><span class="built_in">strcpy</span>(elf_test_p1, <span class="string">"123456"</span>); <span class="comment">// 123456放在常量区，编译器可能会将它与p3所指向的"123456"优化成一个地方。 </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"hello shouwangxiansheng\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">elf_test_add</span><span class="params">(<span class="keyword">int</span> elf_test_a, <span class="keyword">int</span> elf_test_b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> elf_test_a + elf_test_b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ gcc -o hw hw.c </span><br><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ file hw # 到这里，就得到了一个elf文件hw</span><br><span class="line">hw: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=c84796f63e5c5d67f7cb6675615be4733bea872e, not stripped</span><br></pre></td></tr></table></figure>

<h3 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h3><p>查看文件内的字符串</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ strings hw</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 <span class="comment"># 依赖的动态库</span></span><br><span class="line">jcmg8</span><br><span class="line">libc.so.6 <span class="comment"># 依赖的动态库</span></span><br><span class="line">puts</span><br><span class="line">__stack_chk_fail</span><br><span class="line">malloc <span class="comment"># 方法名</span></span><br><span class="line">__cxa_finalize</span><br><span class="line">__libc_start_main</span><br><span class="line">GLIBC_2.4</span><br><span class="line">GLIBC_2.2.5</span><br><span class="line">_ITM_deregisterTMCloneTable</span><br><span class="line">__gmon_start__</span><br><span class="line">_ITM_registerTMCloneTable</span><br><span class="line">=Y	 </span><br><span class="line">=7	 </span><br><span class="line">=:	 </span><br><span class="line">1234f</span><br><span class="line">AWAVI</span><br><span class="line">AUATL</span><br><span class="line">[]A\A]A^A_</span><br><span class="line">123456 <span class="comment"># hw.c 自定义</span></span><br><span class="line">hello shouwangxiansheng <span class="comment"># hw.c 自定义</span></span><br><span class="line">;*3$<span class="string">"</span></span><br><span class="line"><span class="string">GCC: (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0</span></span><br><span class="line"><span class="string">crtstuff.c</span></span><br><span class="line"><span class="string">deregister_tm_clones</span></span><br><span class="line"><span class="string">__do_global_dtors_aux</span></span><br><span class="line"><span class="string">completed.7698</span></span><br><span class="line"><span class="string">__do_global_dtors_aux_fini_array_entry</span></span><br><span class="line"><span class="string">frame_dummy</span></span><br><span class="line"><span class="string">__frame_dummy_init_array_entry</span></span><br><span class="line"><span class="string">hw.c</span></span><br><span class="line"><span class="string">elf_test_c.2949 # hw.c 自定义</span></span><br><span class="line"><span class="string">__FRAME_END__</span></span><br><span class="line"><span class="string">__init_array_end</span></span><br><span class="line"><span class="string">_DYNAMIC</span></span><br><span class="line"><span class="string">__init_array_start</span></span><br><span class="line"><span class="string">__GNU_EH_FRAME_HDR</span></span><br><span class="line"><span class="string">_GLOBAL_OFFSET_TABLE_</span></span><br><span class="line"><span class="string">__libc_csu_fini</span></span><br><span class="line"><span class="string">_ITM_deregisterTMCloneTable</span></span><br><span class="line"><span class="string">puts@@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">_edata</span></span><br><span class="line"><span class="string">__stack_chk_fail@@GLIBC_2.4</span></span><br><span class="line"><span class="string">elf_test_p1 # hw.c 自定义</span></span><br><span class="line"><span class="string">elf_test_a # hw.c 自定义</span></span><br><span class="line"><span class="string">__libc_start_main@@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">__data_start</span></span><br><span class="line"><span class="string">__gmon_start__</span></span><br><span class="line"><span class="string">__dso_handle</span></span><br><span class="line"><span class="string">_IO_stdin_used</span></span><br><span class="line"><span class="string">__libc_csu_init</span></span><br><span class="line"><span class="string">malloc@@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">elf_test_add</span></span><br><span class="line"><span class="string">__bss_start</span></span><br><span class="line"><span class="string">main</span></span><br><span class="line"><span class="string">__TMC_END__</span></span><br><span class="line"><span class="string">_ITM_registerTMCloneTable</span></span><br><span class="line"><span class="string">__cxa_finalize@@GLIBC_2.2.5</span></span><br><span class="line"><span class="string">.symtab # section 名称</span></span><br><span class="line"><span class="string">.strtab</span></span><br><span class="line"><span class="string">.shstrtab</span></span><br><span class="line"><span class="string">.interp</span></span><br><span class="line"><span class="string">.note.ABI-tag</span></span><br><span class="line"><span class="string">.note.gnu.build-id</span></span><br><span class="line"><span class="string">.gnu.hash</span></span><br><span class="line"><span class="string">.dynsym</span></span><br><span class="line"><span class="string">.dynstr</span></span><br><span class="line"><span class="string">.gnu.version</span></span><br><span class="line"><span class="string">.gnu.version_r</span></span><br><span class="line"><span class="string">.rela.dyn</span></span><br><span class="line"><span class="string">.rela.plt</span></span><br><span class="line"><span class="string">.init</span></span><br><span class="line"><span class="string">.plt.got</span></span><br><span class="line"><span class="string">.text</span></span><br><span class="line"><span class="string">.fini</span></span><br><span class="line"><span class="string">.rodata</span></span><br><span class="line"><span class="string">.eh_frame_hdr</span></span><br><span class="line"><span class="string">.eh_frame</span></span><br><span class="line"><span class="string">.init_array</span></span><br><span class="line"><span class="string">.fini_array</span></span><br><span class="line"><span class="string">.dynamic</span></span><br><span class="line"><span class="string">.data</span></span><br><span class="line"><span class="string">.bss</span></span><br><span class="line"><span class="string">.comment</span></span><br></pre></td></tr></table></figure>

<h3 id="ldd"><a href="#ldd" class="headerlink" title="ldd"></a>ldd</h3><p>查看依赖了哪些动态库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ ldd hw <span class="comment"># 可以发现依赖了三个.so</span></span><br><span class="line">	linux-vdso.so.1 (0x00007ffe15b8c000)</span><br><span class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f5cfd134000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f5cfd727000)</span><br></pre></td></tr></table></figure>

<h3 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h3><p>查看符号表, 一般method的名字都会在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ nm hw</span><br><span class="line">0000000000201010 B __bss_start</span><br><span class="line">0000000000201010 b completed.7698</span><br><span class="line">                 w __cxa_finalize@@GLIBC_2.2.5</span><br><span class="line">0000000000201000 D __data_start</span><br><span class="line">0000000000201000 W data_start</span><br><span class="line">0000000000000620 t deregister_tm_clones</span><br><span class="line">00000000000006b0 t __do_global_dtors_aux</span><br><span class="line">0000000000200db0 t __do_global_dtors_aux_fini_array_entry</span><br><span class="line">0000000000201008 D __dso_handle</span><br><span class="line">0000000000200db8 d _DYNAMIC</span><br><span class="line">0000000000201010 D _edata</span><br><span class="line">0000000000201014 B elf_test_a <span class="comment"># 已初始化的全局变量</span></span><br><span class="line">0000000000000780 T elf_test_add <span class="comment"># 方法名</span></span><br><span class="line">0000000000201018 b elf_test_c.2949 <span class="comment"># 已初始化的静态变量</span></span><br><span class="line">0000000000201020 B elf_test_p1 <span class="comment"># 未初始化的全局变量</span></span><br><span class="line">0000000000201028 B _end</span><br><span class="line">0000000000000814 T _fini</span><br><span class="line">00000000000006f0 t frame_dummy</span><br><span class="line">0000000000200da8 t __frame_dummy_init_array_entry</span><br><span class="line">00000000000009ac r __FRAME_END__</span><br><span class="line">0000000000200fa8 d _GLOBAL_OFFSET_TABLE_</span><br><span class="line">                 w __gmon_start__</span><br><span class="line">0000000000000844 r __GNU_EH_FRAME_HDR</span><br><span class="line">0000000000000580 T _init</span><br><span class="line">0000000000200db0 t __init_array_end</span><br><span class="line">0000000000200da8 t __init_array_start</span><br><span class="line">0000000000000820 R _IO_stdin_used</span><br><span class="line">                 w _ITM_deregisterTMCloneTable</span><br><span class="line">                 w _ITM_registerTMCloneTable</span><br><span class="line">0000000000000810 T __libc_csu_fini</span><br><span class="line">00000000000007a0 T __libc_csu_init</span><br><span class="line">                 U __libc_start_main@@GLIBC_2.2.5</span><br><span class="line">00000000000006fa T main</span><br><span class="line">                 U malloc@@GLIBC_2.2.5</span><br><span class="line">                 U puts@@GLIBC_2.2.5</span><br><span class="line">0000000000000660 t register_tm_clones</span><br><span class="line">                 U __stack_chk_fail@@GLIBC_2.4</span><br><span class="line">00000000000005f0 T _start</span><br><span class="line">0000000000201010 D __TMC_END__</span><br></pre></td></tr></table></figure>

<h3 id="size"><a href="#size" class="headerlink" title="size"></a>size</h3><p>查看section size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ size hw</span><br><span class="line">   text	   data	    bss	    dec	    hex	filename</span><br><span class="line">   1883	    616	     24	   2523	    9db	hw</span><br></pre></td></tr></table></figure>

<h3 id="readelf"><a href="#readelf" class="headerlink" title="readelf"></a>readelf</h3><p>顾名思义，查看elf的命令，功能很多。</p>
<p><strong>readelf -h</strong></p>
<p>查看文件头</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ readelf -h hw</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 <span class="comment"># 表明文件类型，告知loader如何加载，如何解码</span></span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2<span class="string">'s complement, little endian</span></span><br><span class="line"><span class="string">  Version:                           1 (current)</span></span><br><span class="line"><span class="string">  OS/ABI:                            UNIX - System V</span></span><br><span class="line"><span class="string">  ABI Version:                       0</span></span><br><span class="line"><span class="string">  Type:                              DYN (Shared object file)</span></span><br><span class="line"><span class="string">  Machine:                           Advanced Micro Devices X86-64</span></span><br><span class="line"><span class="string">  Version:                           0x1</span></span><br><span class="line"><span class="string">  Entry point address:               0x5f0</span></span><br><span class="line"><span class="string">  Start of program headers:          64 (bytes into file)</span></span><br><span class="line"><span class="string">  Start of section headers:          6688 (bytes into file)</span></span><br><span class="line"><span class="string">  Flags:                             0x0</span></span><br><span class="line"><span class="string">  Size of this header:               64 (bytes)</span></span><br><span class="line"><span class="string">  Size of program headers:           56 (bytes)</span></span><br><span class="line"><span class="string">  Number of program headers:         9</span></span><br><span class="line"><span class="string">  Size of section headers:           64 (bytes)</span></span><br><span class="line"><span class="string">  Number of section headers:         29</span></span><br><span class="line"><span class="string">  Section header string table index: 28</span></span><br></pre></td></tr></table></figure>



<p><strong>readelf -l</strong> </p>
<p>显示所有段 segment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ readelf -l hw</span><br><span class="line"></span><br><span class="line">Elf file <span class="built_in">type</span> is DYN (Shared object file)</span><br><span class="line">Entry point 0x5f0</span><br><span class="line">There are 9 program headers, starting at offset 64</span><br><span class="line"></span><br><span class="line">Program Headers:</span><br><span class="line">  Type           Offset             VirtAddr           PhysAddr</span><br><span class="line">                 FileSiz            MemSiz              Flags  Align</span><br><span class="line">  PHDR           0x0000000000000040 0x0000000000000040 0x0000000000000040</span><br><span class="line">                 0x00000000000001f8 0x00000000000001f8  R      0x8</span><br><span class="line">  INTERP         0x0000000000000238 0x0000000000000238 0x0000000000000238</span><br><span class="line">                 0x000000000000001c 0x000000000000001c  R      0x1</span><br><span class="line">      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]</span><br><span class="line">  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">                 0x00000000000009b0 0x00000000000009b0  R E    0x200000</span><br><span class="line">  LOAD           0x0000000000000da8 0x0000000000200da8 0x0000000000200da8</span><br><span class="line">                 0x0000000000000268 0x0000000000000280  RW     0x200000</span><br><span class="line">  DYNAMIC        0x0000000000000db8 0x0000000000200db8 0x0000000000200db8</span><br><span class="line">                 0x00000000000001f0 0x00000000000001f0  RW     0x8</span><br><span class="line">  NOTE           0x0000000000000254 0x0000000000000254 0x0000000000000254</span><br><span class="line">                 0x0000000000000044 0x0000000000000044  R      0x4</span><br><span class="line">  GNU_EH_FRAME   0x0000000000000844 0x0000000000000844 0x0000000000000844</span><br><span class="line">                 0x0000000000000044 0x0000000000000044  R      0x4</span><br><span class="line">  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">                 0x0000000000000000 0x0000000000000000  RW     0x10</span><br><span class="line">  GNU_RELRO      0x0000000000000da8 0x0000000000200da8 0x0000000000200da8</span><br><span class="line">                 0x0000000000000258 0x0000000000000258  R      0x1</span><br><span class="line"></span><br><span class="line"> Section to Segment mapping:</span><br><span class="line">  Segment Sections...</span><br><span class="line">   00     </span><br><span class="line">   01     .interp </span><br><span class="line">   02     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame </span><br><span class="line">   03     .init_array .fini_array .dynamic .got .data .bss </span><br><span class="line">   04     .dynamic </span><br><span class="line">   05     .note.ABI-tag .note.gnu.build-id </span><br><span class="line">   06     .eh_frame_hdr </span><br><span class="line">   07     </span><br><span class="line">   08     .init_array .fini_array .dynamic .got</span><br></pre></td></tr></table></figure>

<p><strong>readelf -S</strong></p>
<p>显示所有sections</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">There are 29 section headers, starting at offset 0x1a20:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000</span><br><span class="line">       0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .interp           PROGBITS         0000000000000238  00000238</span><br><span class="line">       000000000000001c  0000000000000000   A       0     0     1</span><br><span class="line">  [ 2] .note.ABI-tag     NOTE             0000000000000254  00000254</span><br><span class="line">       0000000000000020  0000000000000000   A       0     0     4</span><br><span class="line">  [ 3] .note.gnu.build-i NOTE             0000000000000274  00000274</span><br><span class="line">       0000000000000024  0000000000000000   A       0     0     4</span><br><span class="line">  [ 4] .gnu.hash         GNU_HASH         0000000000000298  00000298</span><br><span class="line">       000000000000001c  0000000000000000   A       5     0     8</span><br><span class="line">  [ 5] .dynsym           DYNSYM           00000000000002b8  000002b8</span><br><span class="line">       00000000000000d8  0000000000000018   A       6     1     8</span><br><span class="line">  [ 6] .dynstr           STRTAB           0000000000000390  00000390</span><br><span class="line">       00000000000000a4  0000000000000000   A       0     0     1</span><br><span class="line">  [ 7] .gnu.version      VERSYM           0000000000000434  00000434</span><br><span class="line">       0000000000000012  0000000000000002   A       5     0     2</span><br><span class="line">  [ 8] .gnu.version_r    VERNEED          0000000000000448  00000448</span><br><span class="line">       0000000000000030  0000000000000000   A       6     1     8</span><br><span class="line">  [ 9] .rela.dyn         RELA             0000000000000478  00000478</span><br><span class="line">       00000000000000c0  0000000000000018   A       5     0     8</span><br><span class="line">  [10] .rela.plt         RELA             0000000000000538  00000538</span><br><span class="line">       0000000000000048  0000000000000018  AI       5    22     8</span><br><span class="line">  [11] .init             PROGBITS         0000000000000580  00000580</span><br><span class="line">       0000000000000017  0000000000000000  AX       0     0     4</span><br><span class="line">  [12] .plt              PROGBITS         00000000000005a0  000005a0</span><br><span class="line">       0000000000000040  0000000000000010  AX       0     0     16</span><br><span class="line">  [13] .plt.got          PROGBITS         00000000000005e0  000005e0</span><br><span class="line">       0000000000000008  0000000000000008  AX       0     0     8</span><br><span class="line">  [14] .text             PROGBITS         00000000000005f0  000005f0</span><br><span class="line">       0000000000000222  0000000000000000  AX       0     0     16</span><br><span class="line">  [15] .fini             PROGBITS         0000000000000814  00000814</span><br><span class="line">       0000000000000009  0000000000000000  AX       0     0     4</span><br><span class="line">  [16] .rodata           PROGBITS         0000000000000820  00000820</span><br><span class="line">       0000000000000023  0000000000000000   A       0     0     4</span><br><span class="line">  [17] .eh_frame_hdr     PROGBITS         0000000000000844  00000844</span><br><span class="line">       0000000000000044  0000000000000000   A       0     0     4</span><br><span class="line">  [18] .eh_frame         PROGBITS         0000000000000888  00000888</span><br><span class="line">       0000000000000128  0000000000000000   A       0     0     8</span><br><span class="line">  [19] .init_array       INIT_ARRAY       0000000000200da8  00000da8</span><br><span class="line">       0000000000000008  0000000000000008  WA       0     0     8</span><br><span class="line">  [20] .fini_array       FINI_ARRAY       0000000000200db0  00000db0</span><br><span class="line">       0000000000000008  0000000000000008  WA       0     0     8</span><br><span class="line">  [21] .dynamic          DYNAMIC          0000000000200db8  00000db8</span><br><span class="line">       00000000000001f0  0000000000000010  WA       6     0     8</span><br><span class="line">  [22] .got              PROGBITS         0000000000200fa8  00000fa8</span><br><span class="line">       0000000000000058  0000000000000008  WA       0     0     8</span><br><span class="line">  [23] .data             PROGBITS         0000000000201000  00001000</span><br><span class="line">       0000000000000010  0000000000000000  WA       0     0     8</span><br><span class="line">  [24] .bss              NOBITS           0000000000201010  00001010</span><br><span class="line">       0000000000000018  0000000000000000  WA       0     0     8</span><br><span class="line">  [25] .comment          PROGBITS         0000000000000000  00001010</span><br><span class="line">       0000000000000029  0000000000000001  MS       0     0     1</span><br><span class="line">  [26] .symtab           SYMTAB           0000000000000000  00001040</span><br><span class="line">       0000000000000678  0000000000000018          27    44     8</span><br><span class="line">  [27] .strtab           STRTAB           0000000000000000  000016b8</span><br><span class="line">       0000000000000264  0000000000000000           0     0     1</span><br><span class="line">  [28] .shstrtab         STRTAB           0000000000000000  0000191c</span><br><span class="line">       00000000000000fe  0000000000000000           0     0     1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  l (large), p (processor specific)</span><br></pre></td></tr></table></figure>

<p><strong>readelf -s</strong></p>
<p>查看所有symbol，类似strings</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ readelf -s hw</span><br><span class="line"></span><br><span class="line">Symbol table <span class="string">'.dynsym'</span> contains 9 entries: <span class="comment"># 可以看到symbol在两个section中 .dynsym 和 .symtab</span></span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab</span><br><span class="line">     2: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND puts@GLIBC_2.2.5 (2)</span><br><span class="line">     3: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __stack_chk_fail@GLIBC_2.4 (3)</span><br><span class="line">     4: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLIBC_2.2.5 (2)</span><br><span class="line">     5: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span><br><span class="line">     6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND malloc@GLIBC_2.2.5 (2)</span><br><span class="line">     7: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable</span><br><span class="line">     8: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.2.5 (2)</span><br><span class="line"></span><br><span class="line">Symbol table <span class="string">'.symtab'</span> contains 69 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 0000000000000238     0 SECTION LOCAL  DEFAULT    1 </span><br><span class="line">     2: 0000000000000254     0 SECTION LOCAL  DEFAULT    2 </span><br><span class="line">     3: 0000000000000274     0 SECTION LOCAL  DEFAULT    3 </span><br><span class="line">     4: 0000000000000298     0 SECTION LOCAL  DEFAULT    4 </span><br><span class="line">     5: 00000000000002b8     0 SECTION LOCAL  DEFAULT    5 </span><br><span class="line">     6: 0000000000000390     0 SECTION LOCAL  DEFAULT    6 </span><br><span class="line">     7: 0000000000000434     0 SECTION LOCAL  DEFAULT    7 </span><br><span class="line">     8: 0000000000000448     0 SECTION LOCAL  DEFAULT    8 </span><br><span class="line">     9: 0000000000000478     0 SECTION LOCAL  DEFAULT    9 </span><br><span class="line">    10: 0000000000000538     0 SECTION LOCAL  DEFAULT   10 </span><br><span class="line">    11: 0000000000000580     0 SECTION LOCAL  DEFAULT   11 </span><br><span class="line">    12: 00000000000005a0     0 SECTION LOCAL  DEFAULT   12 </span><br><span class="line">    13: 00000000000005e0     0 SECTION LOCAL  DEFAULT   13 </span><br><span class="line">    14: 00000000000005f0     0 SECTION LOCAL  DEFAULT   14 </span><br><span class="line">    15: 0000000000000814     0 SECTION LOCAL  DEFAULT   15 </span><br><span class="line">    16: 0000000000000820     0 SECTION LOCAL  DEFAULT   16 </span><br><span class="line">    17: 0000000000000844     0 SECTION LOCAL  DEFAULT   17 </span><br><span class="line">    18: 0000000000000888     0 SECTION LOCAL  DEFAULT   18 </span><br><span class="line">    19: 0000000000200da8     0 SECTION LOCAL  DEFAULT   19 </span><br><span class="line">    20: 0000000000200db0     0 SECTION LOCAL  DEFAULT   20 </span><br><span class="line">    21: 0000000000200db8     0 SECTION LOCAL  DEFAULT   21 </span><br><span class="line">    22: 0000000000200fa8     0 SECTION LOCAL  DEFAULT   22 </span><br><span class="line">    23: 0000000000201000     0 SECTION LOCAL  DEFAULT   23 </span><br><span class="line">    24: 0000000000201010     0 SECTION LOCAL  DEFAULT   24 </span><br><span class="line">    25: 0000000000000000     0 SECTION LOCAL  DEFAULT   25 </span><br><span class="line">    26: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c</span><br><span class="line">    27: 0000000000000620     0 FUNC    LOCAL  DEFAULT   14 deregister_tm_clones</span><br><span class="line">    28: 0000000000000660     0 FUNC    LOCAL  DEFAULT   14 register_tm_clones</span><br><span class="line">    29: 00000000000006b0     0 FUNC    LOCAL  DEFAULT   14 __do_global_dtors_aux</span><br><span class="line">    30: 0000000000201010     1 OBJECT  LOCAL  DEFAULT   24 completed.7698</span><br><span class="line">    31: 0000000000200db0     0 OBJECT  LOCAL  DEFAULT   20 __do_global_dtors_aux_fin</span><br><span class="line">    32: 00000000000006f0     0 FUNC    LOCAL  DEFAULT   14 frame_dummy</span><br><span class="line">    33: 0000000000200da8     0 OBJECT  LOCAL  DEFAULT   19 __frame_dummy_init_array_</span><br><span class="line">    34: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS hw.c</span><br><span class="line">    35: 0000000000201018     4 OBJECT  LOCAL  DEFAULT   24 elf_test_c.2949</span><br><span class="line">    36: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c</span><br><span class="line">    37: 00000000000009ac     0 OBJECT  LOCAL  DEFAULT   18 __FRAME_END__</span><br><span class="line">    38: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS </span><br><span class="line">    39: 0000000000200db0     0 NOTYPE  LOCAL  DEFAULT   19 __init_array_end</span><br><span class="line">    40: 0000000000200db8     0 OBJECT  LOCAL  DEFAULT   21 _DYNAMIC</span><br><span class="line">    41: 0000000000200da8     0 NOTYPE  LOCAL  DEFAULT   19 __init_array_start</span><br><span class="line">    42: 0000000000000844     0 NOTYPE  LOCAL  DEFAULT   17 __GNU_EH_FRAME_HDR</span><br><span class="line">    43: 0000000000200fa8     0 OBJECT  LOCAL  DEFAULT   22 _GLOBAL_OFFSET_TABLE_</span><br><span class="line">    44: 0000000000000810     2 FUNC    GLOBAL DEFAULT   14 __libc_csu_fini</span><br><span class="line">    45: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab</span><br><span class="line">    46: 0000000000201000     0 NOTYPE  WEAK   DEFAULT   23 data_start</span><br><span class="line">    47: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND puts@@GLIBC_2.2.5</span><br><span class="line">    48: 0000000000201010     0 NOTYPE  GLOBAL DEFAULT   23 _edata</span><br><span class="line">    49: 0000000000000814     0 FUNC    GLOBAL DEFAULT   15 _fini</span><br><span class="line">    50: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __stack_chk_fail@@GLIBC_2</span><br><span class="line">    51: 0000000000201020     8 OBJECT  GLOBAL DEFAULT   24 elf_test_p1</span><br><span class="line">    52: 0000000000201014     4 OBJECT  GLOBAL DEFAULT   24 elf_test_a</span><br><span class="line">    53: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@@GLIBC_</span><br><span class="line">    54: 0000000000201000     0 NOTYPE  GLOBAL DEFAULT   23 __data_start</span><br><span class="line">    55: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span><br><span class="line">    56: 0000000000201008     0 OBJECT  GLOBAL HIDDEN    23 __dso_handle</span><br><span class="line">    57: 0000000000000820     4 OBJECT  GLOBAL DEFAULT   16 _IO_stdin_used</span><br><span class="line">    58: 00000000000007a0   101 FUNC    GLOBAL DEFAULT   14 __libc_csu_init</span><br><span class="line">    59: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND malloc@@GLIBC_2.2.5</span><br><span class="line">    60: 0000000000201028     0 NOTYPE  GLOBAL DEFAULT   24 _end</span><br><span class="line">    61: 00000000000005f0    43 FUNC    GLOBAL DEFAULT   14 _start</span><br><span class="line">    62: 0000000000000780    20 FUNC    GLOBAL DEFAULT   14 elf_test_add</span><br><span class="line">    63: 0000000000201010     0 NOTYPE  GLOBAL DEFAULT   24 __bss_start</span><br><span class="line">    64: 00000000000006fa   134 FUNC    GLOBAL DEFAULT   14 main</span><br><span class="line">    65: 0000000000201010     0 OBJECT  GLOBAL HIDDEN    23 __TMC_END__</span><br><span class="line">    66: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable</span><br><span class="line">    67: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@@GLIBC_2.2</span><br><span class="line">    68: 0000000000000580     0 FUNC    GLOBAL DEFAULT   11 _init</span><br></pre></td></tr></table></figure>

<h3 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h3><p>反汇编工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ objdump -d hw</span><br><span class="line"></span><br><span class="line">hw:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .init:</span><br><span class="line"></span><br><span class="line">0000000000000580 &lt;_init&gt;:</span><br><span class="line"> 580:	48 83 ec 08          	sub    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"> 584:	48 8b 05 5d 0a 20 00 	mov    0x200a5d(%rip),%rax        <span class="comment"># 200fe8 &lt;__gmon_start__&gt;</span></span><br><span class="line"> 58b:	48 85 c0             	<span class="built_in">test</span>   %rax,%rax</span><br><span class="line"> 58e:	74 02                	je     592 &lt;_init+0x12&gt;</span><br><span class="line"> 590:	ff d0                	callq  *%rax</span><br><span class="line"> 592:	48 83 c4 08          	add    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"> 596:	c3                   	retq   </span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">00000000000005a0 &lt;.plt&gt;:</span><br><span class="line"> 5a0:	ff 35 0a 0a 20 00    	pushq  0x200a0a(%rip)        <span class="comment"># 200fb0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</span></span><br><span class="line"> 5a6:	ff 25 0c 0a 20 00    	jmpq   *0x200a0c(%rip)        <span class="comment"># 200fb8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</span></span><br><span class="line"> 5ac:	0f 1f 40 00          	nopl   0x0(%rax)            </span><br><span class="line"> <span class="comment"># 这里可以看出elf的延时绑定实现。在动态链接的ELF程序里调用共享库的函数时，第一次调用时先去查找PLT表中相应的项目，而PLT表中再跳跃到GOT表中希望得到该函数的实际地址，但这时GOT表中指向的是PLT中那条跳跃指令下面的代码，最终会执行_dl_runtime_resolve()并执行目标函数。第二次调用时也是PLT跳转到GOT表，但是GOT中对应项目已经在第一次_dl_runtime_resolve()中被修改为函数实际地址，因此第二次及以后的调用直接就去执行目标函数，不用再去执行_dl_runtime_resolve()了。</span></span><br><span class="line"></span><br><span class="line">00000000000005b0 &lt;puts@plt&gt;:</span><br><span class="line"> 5b0:	ff 25 0a 0a 20 00    	jmpq   *0x200a0a(%rip)        <span class="comment"># 200fc0 &lt;puts@GLIBC_2.2.5&gt;</span></span><br><span class="line"> 5b6:	68 00 00 00 00       	pushq  <span class="variable">$0x0</span></span><br><span class="line"> 5bb:	e9 e0 ff ff ff       	jmpq   5a0 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">00000000000005c0 &lt;__stack_chk_fail@plt&gt;:</span><br><span class="line"> 5c0:	ff 25 02 0a 20 00    	jmpq   *0x200a02(%rip)        <span class="comment"># 200fc8 &lt;__stack_chk_fail@GLIBC_2.4&gt;</span></span><br><span class="line"> 5c6:	68 01 00 00 00       	pushq  <span class="variable">$0x1</span></span><br><span class="line"> 5cb:	e9 d0 ff ff ff       	jmpq   5a0 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">00000000000005d0 &lt;malloc@plt&gt;:</span><br><span class="line"> 5d0:	ff 25 fa 09 20 00    	jmpq   *0x2009fa(%rip)        <span class="comment"># 200fd0 &lt;malloc@GLIBC_2.2.5&gt;</span></span><br><span class="line"> 5d6:	68 02 00 00 00       	pushq  <span class="variable">$0x2</span></span><br><span class="line"> 5db:	e9 c0 ff ff ff       	jmpq   5a0 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">Disassembly of section .plt.got:</span><br><span class="line"></span><br><span class="line">00000000000005e0 &lt;__cxa_finalize@plt&gt;:</span><br><span class="line"> 5e0:	ff 25 12 0a 20 00    	jmpq   *0x200a12(%rip)        <span class="comment"># 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span></span><br><span class="line"> 5e6:	66 90                	xchg   %ax,%ax</span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000000005f0 &lt;_start&gt;:</span><br><span class="line"> 5f0:	31 ed                	xor    %ebp,%ebp</span><br><span class="line"> 5f2:	49 89 d1             	mov    %rdx,%r9</span><br><span class="line"> 5f5:	5e                   	pop    %rsi</span><br><span class="line"> 5f6:	48 89 e2             	mov    %rsp,%rdx</span><br><span class="line"> 5f9:	48 83 e4 f0          	and    <span class="variable">$0xfffffffffffffff0</span>,%rsp</span><br><span class="line"> 5fd:	50                   	push   %rax</span><br><span class="line"> 5fe:	54                   	push   %rsp</span><br><span class="line"> 5ff:	4c 8d 05 0a 02 00 00 	lea    0x20a(%rip),%r8        <span class="comment"># 810 &lt;__libc_csu_fini&gt;</span></span><br><span class="line"> 606:	48 8d 0d 93 01 00 00 	lea    0x193(%rip),%rcx        <span class="comment"># 7a0 &lt;__libc_csu_init&gt;</span></span><br><span class="line"> 60d:	48 8d 3d e6 00 00 00 	lea    0xe6(%rip),%rdi        <span class="comment"># 6fa &lt;main&gt;</span></span><br><span class="line"> 614:	ff 15 c6 09 20 00    	callq  *0x2009c6(%rip)        <span class="comment"># 200fe0 &lt;__libc_start_main@GLIBC_2.2.5&gt;</span></span><br><span class="line"> 61a:	f4                   	hlt    </span><br><span class="line"> 61b:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">0000000000000620 &lt;deregister_tm_clones&gt;:</span><br><span class="line"> 620:	48 8d 3d e9 09 20 00 	lea    0x2009e9(%rip),%rdi        <span class="comment"># 201010 &lt;__TMC_END__&gt;</span></span><br><span class="line"> 627:	55                   	push   %rbp</span><br><span class="line"> 628:	48 8d 05 e1 09 20 00 	lea    0x2009e1(%rip),%rax        <span class="comment"># 201010 &lt;__TMC_END__&gt;</span></span><br><span class="line"> 62f:	48 39 f8             	cmp    %rdi,%rax</span><br><span class="line"> 632:	48 89 e5             	mov    %rsp,%rbp</span><br><span class="line"> 635:	74 19                	je     650 &lt;deregister_tm_clones+0x30&gt;</span><br><span class="line"> 637:	48 8b 05 9a 09 20 00 	mov    0x20099a(%rip),%rax        <span class="comment"># 200fd8 &lt;_ITM_deregisterTMCloneTable&gt;</span></span><br><span class="line"> 63e:	48 85 c0             	<span class="built_in">test</span>   %rax,%rax</span><br><span class="line"> 641:	74 0d                	je     650 &lt;deregister_tm_clones+0x30&gt;</span><br><span class="line"> 643:	5d                   	pop    %rbp</span><br><span class="line"> 644:	ff e0                	jmpq   *%rax</span><br><span class="line"> 646:	66 2e 0f 1f 84 00 00 	nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 64d:	00 00 00 </span><br><span class="line"> 650:	5d                   	pop    %rbp</span><br><span class="line"> 651:	c3                   	retq   </span><br><span class="line"> 652:	0f 1f 40 00          	nopl   0x0(%rax)</span><br><span class="line"> 656:	66 2e 0f 1f 84 00 00 	nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 65d:	00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000660 &lt;register_tm_clones&gt;:</span><br><span class="line"> 660:	48 8d 3d a9 09 20 00 	lea    0x2009a9(%rip),%rdi        <span class="comment"># 201010 &lt;__TMC_END__&gt;</span></span><br><span class="line"> 667:	48 8d 35 a2 09 20 00 	lea    0x2009a2(%rip),%rsi        <span class="comment"># 201010 &lt;__TMC_END__&gt;</span></span><br><span class="line"> 66e:	55                   	push   %rbp</span><br><span class="line"> 66f:	48 29 fe             	sub    %rdi,%rsi</span><br><span class="line"> 672:	48 89 e5             	mov    %rsp,%rbp</span><br><span class="line"> 675:	48 c1 fe 03          	sar    <span class="variable">$0x3</span>,%rsi</span><br><span class="line"> 679:	48 89 f0             	mov    %rsi,%rax</span><br><span class="line"> 67c:	48 c1 e8 3f          	shr    <span class="variable">$0x3f</span>,%rax</span><br><span class="line"> 680:	48 01 c6             	add    %rax,%rsi</span><br><span class="line"> 683:	48 d1 fe             	sar    %rsi</span><br><span class="line"> 686:	74 18                	je     6a0 &lt;register_tm_clones+0x40&gt;</span><br><span class="line"> 688:	48 8b 05 61 09 20 00 	mov    0x200961(%rip),%rax        <span class="comment"># 200ff0 &lt;_ITM_registerTMCloneTable&gt;</span></span><br><span class="line"> 68f:	48 85 c0             	<span class="built_in">test</span>   %rax,%rax</span><br><span class="line"> 692:	74 0c                	je     6a0 &lt;register_tm_clones+0x40&gt;</span><br><span class="line"> 694:	5d                   	pop    %rbp</span><br><span class="line"> 695:	ff e0                	jmpq   *%rax</span><br><span class="line"> 697:	66 0f 1f 84 00 00 00 	nopw   0x0(%rax,%rax,1)</span><br><span class="line"> 69e:	00 00 </span><br><span class="line"> 6a0:	5d                   	pop    %rbp</span><br><span class="line"> 6a1:	c3                   	retq   </span><br><span class="line"> 6a2:	0f 1f 40 00          	nopl   0x0(%rax)</span><br><span class="line"> 6a6:	66 2e 0f 1f 84 00 00 	nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 6ad:	00 00 00 </span><br><span class="line"></span><br><span class="line">00000000000006b0 &lt;__do_global_dtors_aux&gt;:</span><br><span class="line"> 6b0:	80 3d 59 09 20 00 00 	cmpb   <span class="variable">$0x0</span>,0x200959(%rip)        <span class="comment"># 201010 &lt;__TMC_END__&gt;</span></span><br><span class="line"> 6b7:	75 2f                	jne    6e8 &lt;__do_global_dtors_aux+0x38&gt;</span><br><span class="line"> 6b9:	48 83 3d 37 09 20 00 	cmpq   <span class="variable">$0x0</span>,0x200937(%rip)        <span class="comment"># 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span></span><br><span class="line"> 6c0:	00 </span><br><span class="line"> 6c1:	55                   	push   %rbp</span><br><span class="line"> 6c2:	48 89 e5             	mov    %rsp,%rbp</span><br><span class="line"> 6c5:	74 0c                	je     6d3 &lt;__do_global_dtors_aux+0x23&gt;</span><br><span class="line"> 6c7:	48 8b 3d 3a 09 20 00 	mov    0x20093a(%rip),%rdi        <span class="comment"># 201008 &lt;__dso_handle&gt;</span></span><br><span class="line"> 6ce:	e8 0d ff ff ff       	callq  5e0 &lt;__cxa_finalize@plt&gt;</span><br><span class="line"> 6d3:	e8 48 ff ff ff       	callq  620 &lt;deregister_tm_clones&gt;</span><br><span class="line"> 6d8:	c6 05 31 09 20 00 01 	movb   <span class="variable">$0x1</span>,0x200931(%rip)        <span class="comment"># 201010 &lt;__TMC_END__&gt;</span></span><br><span class="line"> 6df:	5d                   	pop    %rbp</span><br><span class="line"> 6e0:	c3                   	retq   </span><br><span class="line"> 6e1:	0f 1f 80 00 00 00 00 	nopl   0x0(%rax)</span><br><span class="line"> 6e8:	f3 c3                	repz retq </span><br><span class="line"> 6ea:	66 0f 1f 44 00 00    	nopw   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">00000000000006f0 &lt;frame_dummy&gt;:</span><br><span class="line"> 6f0:	55                   	push   %rbp</span><br><span class="line"> 6f1:	48 89 e5             	mov    %rsp,%rbp</span><br><span class="line"> 6f4:	5d                   	pop    %rbp</span><br><span class="line"> 6f5:	e9 66 ff ff ff       	jmpq   660 &lt;register_tm_clones&gt;</span><br><span class="line"></span><br><span class="line">00000000000006fa &lt;main&gt;:</span><br><span class="line"> 6fa:	55                   	push   %rbp</span><br><span class="line"> 6fb:	48 89 e5             	mov    %rsp,%rbp</span><br><span class="line"> 6fe:	48 83 ec 20          	sub    <span class="variable">$0x20</span>,%rsp</span><br><span class="line"> 702:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line"> 709:	00 00 </span><br><span class="line"> 70b:	48 89 45 f8          	mov    %rax,-0x8(%rbp)</span><br><span class="line"> 70f:	31 c0                	xor    %eax,%eax</span><br><span class="line"> 711:	c7 45 f4 61 62 63 00 	movl   <span class="variable">$0x636261</span>,-0xc(%rbp)</span><br><span class="line"> 718:	48 8d 05 05 01 00 00 	lea    0x105(%rip),%rax        <span class="comment"># 824 &lt;_IO_stdin_used+0x4&gt;</span></span><br><span class="line"> 71f:	48 89 45 e0          	mov    %rax,-0x20(%rbp)</span><br><span class="line"> 723:	bf 0a 00 00 00       	mov    <span class="variable">$0xa</span>,%edi</span><br><span class="line"> 728:	e8 a3 fe ff ff       	callq  5d0 &lt;malloc@plt&gt;</span><br><span class="line"> 72d:	48 89 05 ec 08 20 00 	mov    %rax,0x2008ec(%rip)        <span class="comment"># 201020 &lt;elf_test_p1&gt;</span></span><br><span class="line"> 734:	bf 14 00 00 00       	mov    <span class="variable">$0x14</span>,%edi</span><br><span class="line"> 739:	e8 92 fe ff ff       	callq  5d0 &lt;malloc@plt&gt;</span><br><span class="line"> 73e:	48 89 45 e8          	mov    %rax,-0x18(%rbp)</span><br><span class="line"> 742:	48 8b 05 d7 08 20 00 	mov    0x2008d7(%rip),%rax        <span class="comment"># 201020 &lt;elf_test_p1&gt;</span></span><br><span class="line"> 749:	c7 00 31 32 33 34    	movl   <span class="variable">$0x34333231</span>,(%rax)</span><br><span class="line"> 74f:	66 c7 40 04 35 36    	movw   <span class="variable">$0x3635</span>,0x4(%rax)</span><br><span class="line"> 755:	c6 40 06 00          	movb   <span class="variable">$0x0</span>,0x6(%rax)</span><br><span class="line"> 759:	48 8d 3d cb 00 00 00 	lea    0xcb(%rip),%rdi        <span class="comment"># 82b &lt;_IO_stdin_used+0xb&gt;</span></span><br><span class="line"> 760:	e8 4b fe ff ff       	callq  5b0 &lt;puts@plt&gt;</span><br><span class="line"> 765:	b8 00 00 00 00       	mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line"> 76a:	48 8b 55 f8          	mov    -0x8(%rbp),%rdx</span><br><span class="line"> 76e:	64 48 33 14 25 28 00 	xor    %fs:0x28,%rdx</span><br><span class="line"> 775:	00 00 </span><br><span class="line"> 777:	74 05                	je     77e &lt;main+0x84&gt;</span><br><span class="line"> 779:	e8 42 fe ff ff       	callq  5c0 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line"> 77e:	c9                   	leaveq </span><br><span class="line"> 77f:	c3                   	retq   </span><br><span class="line"></span><br><span class="line">0000000000000780 &lt;elf_test_add&gt;:</span><br><span class="line"> 780:	55                   	push   %rbp</span><br><span class="line"> 781:	48 89 e5             	mov    %rsp,%rbp</span><br><span class="line"> 784:	89 7d <span class="built_in">fc</span>             	mov    %edi,-0x4(%rbp)</span><br><span class="line"> 787:	89 75 f8             	mov    %esi,-0x8(%rbp)</span><br><span class="line"> 78a:	8b 55 <span class="built_in">fc</span>             	mov    -0x4(%rbp),%edx</span><br><span class="line"> 78d:	8b 45 f8             	mov    -0x8(%rbp),%eax</span><br><span class="line"> 790:	01 d0                	add    %edx,%eax</span><br><span class="line"> 792:	5d                   	pop    %rbp</span><br><span class="line"> 793:	c3                   	retq   </span><br><span class="line"> 794:	66 2e 0f 1f 84 00 00 	nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 79b:	00 00 00 </span><br><span class="line"> 79e:	66 90                	xchg   %ax,%ax</span><br><span class="line"></span><br><span class="line">00000000000007a0 &lt;__libc_csu_init&gt;:</span><br><span class="line"> 7a0:	41 57                	push   %r15</span><br><span class="line"> 7a2:	41 56                	push   %r14</span><br><span class="line"> 7a4:	49 89 d7             	mov    %rdx,%r15</span><br><span class="line"> 7a7:	41 55                	push   %r13</span><br><span class="line"> 7a9:	41 54                	push   %r12</span><br><span class="line"> 7ab:	4c 8d 25 f6 05 20 00 	lea    0x2005f6(%rip),%r12        <span class="comment"># 200da8 &lt;__frame_dummy_init_array_entry&gt;</span></span><br><span class="line"> 7b2:	55                   	push   %rbp</span><br><span class="line"> 7b3:	48 8d 2d f6 05 20 00 	lea    0x2005f6(%rip),%rbp        <span class="comment"># 200db0 &lt;__init_array_end&gt;</span></span><br><span class="line"> 7ba:	53                   	push   %rbx</span><br><span class="line"> 7bb:	41 89 fd             	mov    %edi,%r13d</span><br><span class="line"> 7be:	49 89 f6             	mov    %rsi,%r14</span><br><span class="line"> 7c1:	4c 29 e5             	sub    %r12,%rbp</span><br><span class="line"> 7c4:	48 83 ec 08          	sub    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"> 7c8:	48 c1 fd 03          	sar    <span class="variable">$0x3</span>,%rbp</span><br><span class="line"> 7cc:	e8 af fd ff ff       	callq  580 &lt;_init&gt;</span><br><span class="line"> 7d1:	48 85 ed             	<span class="built_in">test</span>   %rbp,%rbp</span><br><span class="line"> 7d4:	74 20                	je     7f6 &lt;__libc_csu_init+0x56&gt;</span><br><span class="line"> 7d6:	31 db                	xor    %ebx,%ebx</span><br><span class="line"> 7d8:	0f 1f 84 00 00 00 00 	nopl   0x0(%rax,%rax,1)</span><br><span class="line"> 7df:	00 </span><br><span class="line"> 7e0:	4c 89 fa             	mov    %r15,%rdx</span><br><span class="line"> 7e3:	4c 89 f6             	mov    %r14,%rsi</span><br><span class="line"> 7e6:	44 89 ef             	mov    %r13d,%edi</span><br><span class="line"> 7e9:	41 ff 14 dc          	callq  *(%r12,%rbx,8)</span><br><span class="line"> 7ed:	48 83 c3 01          	add    <span class="variable">$0x1</span>,%rbx</span><br><span class="line"> 7f1:	48 39 dd             	cmp    %rbx,%rbp</span><br><span class="line"> 7f4:	75 ea                	jne    7e0 &lt;__libc_csu_init+0x40&gt;</span><br><span class="line"> 7f6:	48 83 c4 08          	add    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"> 7fa:	5b                   	pop    %rbx</span><br><span class="line"> 7fb:	5d                   	pop    %rbp</span><br><span class="line"> 7fc:	41 5c                	pop    %r12</span><br><span class="line"> 7fe:	41 5d                	pop    %r13</span><br><span class="line"> 800:	41 5e                	pop    %r14</span><br><span class="line"> 802:	41 5f                	pop    %r15</span><br><span class="line"> 804:	c3                   	retq   </span><br><span class="line"> 805:	90                   	nop</span><br><span class="line"> 806:	66 2e 0f 1f 84 00 00 	nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 80d:	00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000810 &lt;__libc_csu_fini&gt;:</span><br><span class="line"> 810:	f3 c3                	repz retq </span><br><span class="line"></span><br><span class="line">Disassembly of section .fini:</span><br><span class="line"></span><br><span class="line">0000000000000814 &lt;_fini&gt;:</span><br><span class="line"> 814:	48 83 ec 08          	sub    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"> 818:	48 83 c4 08          	add    <span class="variable">$0x8</span>,%rsp</span><br><span class="line"> 81c:	c3                   	retq</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-14-ubuntu:~/elf$ objdump -s hw</span><br><span class="line"></span><br><span class="line">hw:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Contents of section .interp:</span><br><span class="line"> 0238 2f6c6962 36342f6c 642d6c69 6e75782d  /lib64/ld-linux-</span><br><span class="line"> 0248 7838362d 36342e73 6f2e3200           x86-64.so.2.    </span><br><span class="line">Contents of section .note.ABI-tag:</span><br><span class="line"> 0254 04000000 10000000 01000000 474e5500  ............GNU.</span><br><span class="line"> 0264 00000000 03000000 02000000 00000000  ................</span><br><span class="line">Contents of section .note.gnu.build-id:</span><br><span class="line"> 0274 04000000 14000000 03000000 474e5500  ............GNU.</span><br><span class="line"> 0284 3e98dc09 7796ad6a 636d6738 bccd92fd  &gt;...w..jcmg8....</span><br><span class="line"> 0294 8468b16b                             .h.k            </span><br><span class="line">Contents of section .gnu.hash:</span><br><span class="line"> 0298 01000000 01000000 01000000 00000000  ................</span><br><span class="line"> 02a8 00000000 00000000 00000000           ............    </span><br><span class="line">Contents of section .dynsym:</span><br><span class="line"> 02b8 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 02c8 00000000 00000000 5f000000 20000000  ........_... ...</span><br><span class="line"> 02d8 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 02e8 0b000000 12000000 00000000 00000000  ................</span><br><span class="line"> 02f8 00000000 00000000 10000000 12000000  ................</span><br><span class="line"> 0308 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 0318 37000000 12000000 00000000 00000000  7...............</span><br><span class="line"> 0328 00000000 00000000 7b000000 20000000  ........&#123;... ...</span><br><span class="line"> 0338 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 0348 21000000 12000000 00000000 00000000  !...............</span><br><span class="line"> 0358 00000000 00000000 8a000000 20000000  ............ ...</span><br><span class="line"> 0368 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 0378 28000000 22000000 00000000 00000000  (...<span class="string">"...........</span></span><br><span class="line"><span class="string"> 0388 00000000 00000000                    ........        </span></span><br><span class="line"><span class="string">Contents of section .dynstr:</span></span><br><span class="line"><span class="string"> 0390 006c6962 632e736f 2e360070 75747300  .libc.so.6.puts.</span></span><br><span class="line"><span class="string"> 03a0 5f5f7374 61636b5f 63686b5f 6661696c  __stack_chk_fail</span></span><br><span class="line"><span class="string"> 03b0 006d616c 6c6f6300 5f5f6378 615f6669  .malloc.__cxa_fi</span></span><br><span class="line"><span class="string"> 03c0 6e616c69 7a65005f 5f6c6962 635f7374  nalize.__libc_st</span></span><br><span class="line"><span class="string"> 03d0 6172745f 6d61696e 00474c49 42435f32  art_main.GLIBC_2</span></span><br><span class="line"><span class="string"> 03e0 2e340047 4c494243 5f322e32 2e35005f  .4.GLIBC_2.2.5._</span></span><br><span class="line"><span class="string"> 03f0 49544d5f 64657265 67697374 6572544d  ITM_deregisterTM</span></span><br><span class="line"><span class="string"> 0400 436c6f6e 65546162 6c65005f 5f676d6f  CloneTable.__gmo</span></span><br><span class="line"><span class="string"> 0410 6e5f7374 6172745f 5f005f49 544d5f72  n_start__._ITM_r</span></span><br><span class="line"><span class="string"> 0420 65676973 74657254 4d436c6f 6e655461  egisterTMCloneTa</span></span><br><span class="line"><span class="string"> 0430 626c6500                             ble.            </span></span><br><span class="line"><span class="string">Contents of section .gnu.version:</span></span><br><span class="line"><span class="string"> 0434 00000000 02000300 02000000 02000000  ................</span></span><br><span class="line"><span class="string"> 0444 0200                                 ..              </span></span><br><span class="line"><span class="string">Contents of section .gnu.version_r:</span></span><br><span class="line"><span class="string"> 0448 01000200 01000000 10000000 00000000  ................</span></span><br><span class="line"><span class="string"> 0458 1469690d 00000300 49000000 10000000  .ii.....I.......</span></span><br><span class="line"><span class="string"> 0468 751a6909 00000200 53000000 00000000  u.i.....S.......</span></span><br><span class="line"><span class="string">Contents of section .rela.dyn:</span></span><br><span class="line"><span class="string"> 0478 a80d2000 00000000 08000000 00000000  .. .............</span></span><br><span class="line"><span class="string"> 0488 f0060000 00000000 b00d2000 00000000  .......... .....</span></span><br><span class="line"><span class="string"> 0498 08000000 00000000 b0060000 00000000  ................</span></span><br><span class="line"><span class="string"> 04a8 08102000 00000000 08000000 00000000  .. .............</span></span><br><span class="line"><span class="string"> 04b8 08102000 00000000 d80f2000 00000000  .. ....... .....</span></span><br><span class="line"><span class="string"> 04c8 06000000 01000000 00000000 00000000  ................</span></span><br><span class="line"><span class="string"> 04d8 e00f2000 00000000 06000000 04000000  .. .............</span></span><br><span class="line"><span class="string"> 04e8 00000000 00000000 e80f2000 00000000  .......... .....</span></span><br><span class="line"><span class="string"> 04f8 06000000 05000000 00000000 00000000  ................</span></span><br><span class="line"><span class="string"> 0508 f00f2000 00000000 06000000 07000000  .. .............</span></span><br><span class="line"><span class="string"> 0518 00000000 00000000 f80f2000 00000000  .......... .....</span></span><br><span class="line"><span class="string"> 0528 06000000 08000000 00000000 00000000  ................</span></span><br><span class="line"><span class="string">Contents of section .rela.plt:</span></span><br><span class="line"><span class="string"> 0538 c00f2000 00000000 07000000 02000000  .. .............</span></span><br><span class="line"><span class="string"> 0548 00000000 00000000 c80f2000 00000000  .......... .....</span></span><br><span class="line"><span class="string"> 0558 07000000 03000000 00000000 00000000  ................</span></span><br><span class="line"><span class="string"> 0568 d00f2000 00000000 07000000 06000000  .. .............</span></span><br><span class="line"><span class="string"> 0578 00000000 00000000                    ........        </span></span><br><span class="line"><span class="string">Contents of section .init:</span></span><br><span class="line"><span class="string"> 0580 4883ec08 488b055d 0a200048 85c07402  H...H..]. .H..t.</span></span><br><span class="line"><span class="string"> 0590 ffd04883 c408c3                      ..H....         </span></span><br><span class="line"><span class="string">Contents of section .plt:</span></span><br><span class="line"><span class="string"> 05a0 ff350a0a 2000ff25 0c0a2000 0f1f4000  .5.. ..%.. ...@.</span></span><br><span class="line"><span class="string"> 05b0 ff250a0a 20006800 000000e9 e0ffffff  .%.. .h.........</span></span><br><span class="line"><span class="string"> 05c0 ff25020a 20006801 000000e9 d0ffffff  .%.. .h.........</span></span><br><span class="line"><span class="string"> 05d0 ff25fa09 20006802 000000e9 c0ffffff  .%.. .h.........</span></span><br><span class="line"><span class="string">Contents of section .plt.got:</span></span><br><span class="line"><span class="string"> 05e0 ff25120a 20006690                    .%.. .f.        </span></span><br><span class="line"><span class="string">Contents of section .text:</span></span><br><span class="line"><span class="string"> 05f0 31ed4989 d15e4889 e24883e4 f050544c  1.I..^H..H...PTL</span></span><br><span class="line"><span class="string"> 0600 8d050a02 0000488d 0d930100 00488d3d  ......H......H.=</span></span><br><span class="line"><span class="string"> 0610 e6000000 ff15c609 2000f40f 1f440000  ........ ....D..</span></span><br><span class="line"><span class="string"> 0620 488d3de9 09200055 488d05e1 09200048  H.=.. .UH.... .H</span></span><br><span class="line"><span class="string"> 0630 39f84889 e5741948 8b059a09 20004885  9.H..t.H.... .H.</span></span><br><span class="line"><span class="string"> 0640 c0740d5d ffe0662e 0f1f8400 00000000  .t.]..f.........</span></span><br><span class="line"><span class="string"> 0650 5dc30f1f 4000662e 0f1f8400 00000000  ]...@.f.........</span></span><br><span class="line"><span class="string"> 0660 488d3da9 09200048 8d35a209 20005548  H.=.. .H.5.. .UH</span></span><br><span class="line"><span class="string"> 0670 29fe4889 e548c1fe 034889f0 48c1e83f  ).H..H...H..H..?</span></span><br><span class="line"><span class="string"> 0680 4801c648 d1fe7418 488b0561 09200048  H..H..t.H..a. .H</span></span><br><span class="line"><span class="string"> 0690 85c0740c 5dffe066 0f1f8400 00000000  ..t.]..f........</span></span><br><span class="line"><span class="string"> 06a0 5dc30f1f 4000662e 0f1f8400 00000000  ]...@.f.........</span></span><br><span class="line"><span class="string"> 06b0 803d5909 20000075 2f48833d 37092000  .=Y. ..u/H.=7. .</span></span><br><span class="line"><span class="string"> 06c0 00554889 e5740c48 8b3d3a09 2000e80d  .UH..t.H.=:. ...</span></span><br><span class="line"><span class="string"> 06d0 ffffffe8 48ffffff c6053109 2000015d  ....H.....1. ..]</span></span><br><span class="line"><span class="string"> 06e0 c30f1f80 00000000 f3c3660f 1f440000  ..........f..D..</span></span><br><span class="line"><span class="string"> 06f0 554889e5 5de966ff ffff5548 89e54883  UH..].f...UH..H.</span></span><br><span class="line"><span class="string"> 0700 ec206448 8b042528 00000048 8945f831  . dH..%(...H.E.1</span></span><br><span class="line"><span class="string"> 0710 c0c745f4 61626300 488d0505 01000048  ..E.abc.H......H</span></span><br><span class="line"><span class="string"> 0720 8945e0bf 0a000000 e8a3feff ff488905  .E...........H..</span></span><br><span class="line"><span class="string"> 0730 ec082000 bf140000 00e892fe ffff4889  .. ...........H.</span></span><br><span class="line"><span class="string"> 0740 45e8488b 05d70820 00c70031 32333466  E.H.... ...1234f</span></span><br><span class="line"><span class="string"> 0750 c7400435 36c64006 00488d3d cb000000  .@.56.@..H.=....</span></span><br><span class="line"><span class="string"> 0760 e84bfeff ffb80000 0000488b 55f86448  .K........H.U.dH</span></span><br><span class="line"><span class="string"> 0770 33142528 00000074 05e842fe ffffc9c3  3.%(...t..B.....</span></span><br><span class="line"><span class="string"> 0780 554889e5 897dfc89 75f88b55 fc8b45f8  UH...&#125;..u..U..E.</span></span><br><span class="line"><span class="string"> 0790 01d05dc3 662e0f1f 84000000 00006690  ..].f.........f.</span></span><br><span class="line"><span class="string"> 07a0 41574156 4989d741 5541544c 8d25f605  AWAVI..AUATL.%..</span></span><br><span class="line"><span class="string"> 07b0 20005548 8d2df605 20005341 89fd4989   .UH.-.. .SA..I.</span></span><br><span class="line"><span class="string"> 07c0 f64c29e5 4883ec08 48c1fd03 e8affdff  .L).H...H.......</span></span><br><span class="line"><span class="string"> 07d0 ff4885ed 742031db 0f1f8400 00000000  .H..t 1.........</span></span><br><span class="line"><span class="string"> 07e0 4c89fa4c 89f64489 ef41ff14 dc4883c3  L..L..D..A...H..</span></span><br><span class="line"><span class="string"> 07f0 014839dd 75ea4883 c4085b5d 415c415d  .H9.u.H...[]A\A]</span></span><br><span class="line"><span class="string"> 0800 415e415f c390662e 0f1f8400 00000000  A^A_..f.........</span></span><br><span class="line"><span class="string"> 0810 f3c3                                 ..              </span></span><br><span class="line"><span class="string">Contents of section .fini:</span></span><br><span class="line"><span class="string"> 0814 4883ec08 4883c408 c3                 H...H....       </span></span><br><span class="line"><span class="string">Contents of section .rodata: # 可以看到这里存储的是hw.c中的静态常量和printf中的字符串</span></span><br><span class="line"><span class="string"> 0820 01000200 31323334 35360068 656c6c6f  ....123456.hello</span></span><br><span class="line"><span class="string"> 0830 2073686f 7577616e 67786961 6e736865   shouwangxianshe</span></span><br><span class="line"><span class="string"> 0840 6e6700                               ng.             </span></span><br><span class="line"><span class="string">Contents of section .eh_frame_hdr:</span></span><br><span class="line"><span class="string"> 0844 011b033b 40000000 07000000 5cfdffff  ...;@.......\...</span></span><br><span class="line"><span class="string"> 0854 8c000000 9cfdffff b4000000 acfdffff  ................</span></span><br><span class="line"><span class="string"> 0864 5c000000 b6feffff cc000000 3cffffff  \...........&lt;...</span></span><br><span class="line"><span class="string"> 0874 ec000000 5cffffff 0c010000 ccffffff  ....\...........</span></span><br><span class="line"><span class="string"> 0884 54010000                             T...            </span></span><br><span class="line"><span class="string">Contents of section .eh_frame:</span></span><br><span class="line"><span class="string"> 0888 14000000 00000000 017a5200 01781001  .........zR..x..</span></span><br><span class="line"><span class="string"> 0898 1b0c0708 90010710 14000000 1c000000  ................</span></span><br><span class="line"><span class="string"> 08a8 48fdffff 2b000000 00000000 00000000  H...+...........</span></span><br><span class="line"><span class="string"> 08b8 14000000 00000000 017a5200 01781001  .........zR..x..</span></span><br><span class="line"><span class="string"> 08c8 1b0c0708 90010000 24000000 1c000000  ........$.......</span></span><br><span class="line"><span class="string"> 08d8 c8fcffff 40000000 000e1046 0e184a0f  ....@......F..J.</span></span><br><span class="line"><span class="string"> 08e8 0b770880 003f1a3b 2a332422 00000000  .w...?.;*3$"</span>....</span><br><span class="line"> 08f8 14000000 44000000 e0fcffff 08000000  ....D...........</span><br><span class="line"> 0908 00000000 00000000 1c000000 5c000000  ............\...</span><br><span class="line"> 0918 e2fdffff 86000000 00410e10 8602430d  .........A....C.</span><br><span class="line"> 0928 0602810c 07080000 1c000000 7c000000  ............|...</span><br><span class="line"> 0938 48feffff 14000000 00410e10 8602430d  H........A....C.</span><br><span class="line"> 0948 064f0c07 08000000 44000000 9c000000  .O......D.......</span><br><span class="line"> 0958 48feffff 65000000 00420e10 8f02420e  H...e....B....B.</span><br><span class="line"> 0968 188e0345 0e208d04 420e288c 05480e30  ...E. ..B.(..H.0</span><br><span class="line"> 0978 8606480e 3883074d 0e40720e 38410e30  ..H.8..M.@r.8A.0</span><br><span class="line"> 0988 410e2842 0e20420e 18420e10 420e0800  A.(B. B..B..B...</span><br><span class="line"> 0998 10000000 e4000000 70feffff 02000000  ........p.......</span><br><span class="line"> 09a8 00000000 00000000                    ........        </span><br><span class="line">Contents of section .init_array:</span><br><span class="line"> 200da8 f0060000 00000000                    ........        </span><br><span class="line">Contents of section .fini_array:</span><br><span class="line"> 200db0 b0060000 00000000                    ........        </span><br><span class="line">Contents of section .dynamic:</span><br><span class="line"> 200db8 01000000 00000000 01000000 00000000  ................</span><br><span class="line"> 200dc8 0c000000 00000000 80050000 00000000  ................</span><br><span class="line"> 200dd8 0d000000 00000000 14080000 00000000  ................</span><br><span class="line"> 200de8 19000000 00000000 a80d2000 00000000  .......... .....</span><br><span class="line"> 200df8 1b000000 00000000 08000000 00000000  ................</span><br><span class="line"> 200e08 1a000000 00000000 b00d2000 00000000  .......... .....</span><br><span class="line"> 200e18 1c000000 00000000 08000000 00000000  ................</span><br><span class="line"> 200e28 f5feff6f 00000000 98020000 00000000  ...o............</span><br><span class="line"> 200e38 05000000 00000000 90030000 00000000  ................</span><br><span class="line"> 200e48 06000000 00000000 b8020000 00000000  ................</span><br><span class="line"> 200e58 0a000000 00000000 a4000000 00000000  ................</span><br><span class="line"> 200e68 0b000000 00000000 18000000 00000000  ................</span><br><span class="line"> 200e78 15000000 00000000 00000000 00000000  ................</span><br><span class="line"> 200e88 03000000 00000000 a80f2000 00000000  .......... .....</span><br><span class="line"> 200e98 02000000 00000000 48000000 00000000  ........H.......</span><br><span class="line"> 200ea8 14000000 00000000 07000000 00000000  ................</span><br><span class="line"> 200eb8 17000000 00000000 38050000 00000000  ........8.......</span><br><span class="line"> 200ec8 07000000 00000000 78040000 00000000  ........x.......</span><br><span class="line"> 200ed8 08000000 00000000 c0000000 00000000  ................</span><br><span class="line"> 200ee8 09000000 00000000 18000000 00000000  ................</span><br><span class="line"> 200ef8 1e000000 00000000 08000000 00000000  ................</span><br><span class="line"> 200f08 fbffff6f 00000000 01000008 00000000  ...o............</span><br><span class="line"> 200f18 feffff6f 00000000 48040000 00000000  ...o....H.......</span><br><span class="line"> 200f28 ffffff6f 00000000 01000000 00000000  ...o............</span><br><span class="line"> 200f38 f0ffff6f 00000000 34040000 00000000  ...o....4.......</span><br><span class="line"> 200f48 f9ffff6f 00000000 03000000 00000000  ...o............</span><br><span class="line"> 200f58 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 200f68 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 200f78 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 200f88 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 200f98 00000000 00000000 00000000 00000000  ................</span><br><span class="line">Contents of section .got:</span><br><span class="line"> 200fa8 b80d2000 00000000 00000000 00000000  .. .............</span><br><span class="line"> 200fb8 00000000 00000000 b6050000 00000000  ................</span><br><span class="line"> 200fc8 c6050000 00000000 d6050000 00000000  ................</span><br><span class="line"> 200fd8 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 200fe8 00000000 00000000 00000000 00000000  ................</span><br><span class="line"> 200ff8 00000000 00000000                    ........        </span><br><span class="line">Contents of section .data:</span><br><span class="line"> 201000 00000000 00000000 08102000 00000000  .......... .....</span><br><span class="line"> 201010 ffffffff ffffffff                    ........ <span class="comment"># 这里对应了hw.c中被初始化为-1的全局变量和静态变量</span></span><br><span class="line"><span class="comment"># 注意这里没有.bss段，因为bss段不占空间</span></span><br><span class="line">Contents of section .comment:</span><br><span class="line"> 0000 4743433a 20285562 756e7475 20372e35  GCC: (Ubuntu 7.5</span><br><span class="line"> 0010 2e302d33 7562756e 7475317e 31382e30  .0-3ubuntu1~18.0</span><br><span class="line"> 0020 34292037 2e352e30 00                 4) 7.5.0.</span><br></pre></td></tr></table></figure>




<p>参考： <a href="https://refspecs.linuxfoundation.org/elf/elf.pdf" target="_blank" rel="noopener">https://refspecs.linuxfoundation.org/elf/elf.pdf</a></p>
<p><a href="https://bbs.pediy.com/thread-259901.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-259901.htm</a></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/07/14/elf-format/" data-id="ckse37dn70020olj5bmv3a117"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elf/" rel="tag">elf</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-android-uid" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/11/android-uid/"
    >android uid介绍</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/07/11/android-uid/" class="article-date">
  <time datetime="2021-07-11T09:46:40.000Z" itemprop="datePublished">2021-07-11</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="uid-是什么"><a href="#uid-是什么" class="headerlink" title="uid 是什么"></a>uid 是什么</h2><p>android中uid用于标识一个应用程序，uid在应用安装时被分配，并且在应用存在于手机上期间，都不会改变。一个应用程序只能有一个uid，多个应用可以使用sharedUserId 方式共享同一个uid，前提是这些应用的签名要相同。</p>
<h2 id="uid-怎么生成的"><a href="#uid-怎么生成的" class="headerlink" title="uid 怎么生成的"></a>uid 怎么生成的</h2><p>uid是在app安装的时候分配的，关键代码如下：</p>
<p><strong>以下代码来自android-10.0.0_r1</strong></p>
<p>首先是在<a href="https://cs.android.com/android/platform/superproject/+/android-10.0.0_r1:frameworks/base/services/core/java/com/android/server/pm/PackageManagerService.java" target="_blank" rel="noopener">PMS</a>中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Prepares the system to commit a &#123;<span class="doctag">@link</span> ScanResult&#125; in a way that will not fail by registering</span></span><br><span class="line"><span class="comment"> * the app ID required for reconcile.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if a new app ID was registered and will need to be cleaned up on</span></span><br><span class="line"><span class="comment"> *         failure.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">optimisticallyRegisterAppId</span><span class="params">(@NonNull ScanResult result)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> PackageManagerException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!result.existingSettingCopied) &#123;</span><br><span class="line">        <span class="comment">// THROWS: when we can't allocate a user id. add call to check if there's</span></span><br><span class="line">        <span class="comment">// enough space to ensure we won't throw; otherwise, don't modify state</span></span><br><span class="line">        <span class="comment">// 这里注册新的app id，也就是uid</span></span><br><span class="line">        <span class="keyword">return</span> mSettings.registerAppIdLPw(result.pkgSetting);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在<a href="https://cs.android.com/android/platform/superproject/+/android-10.0.0_r1:frameworks/base/services/core/java/com/android/server/pm/Settings.java" target="_blank" rel="noopener">Settings</a>中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Registers a user ID with the system. Potentially allocates a new user ID.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if a new app ID was created in the process. &#123;<span class="doctag">@code</span> false&#125; can be</span></span><br><span class="line"><span class="comment"> *         returned in the case that a shared user ID already exists or the explicit app ID is</span></span><br><span class="line"><span class="comment"> *         already registered.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> PackageManagerException If a user ID could not be allocated.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">registerAppIdLPw</span><span class="params">(PackageSetting p)</span> <span class="keyword">throws</span> PackageManagerException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> createdNew;</span><br><span class="line">    <span class="keyword">if</span> (p.appId == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// Assign new user ID</span></span><br><span class="line">        <span class="comment">// 这里注册新uid</span></span><br><span class="line">        p.appId = acquireAndRegisterNewAppIdLPw(p);</span><br><span class="line">        createdNew = <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Add new setting to list of user IDs</span></span><br><span class="line">        createdNew = registerExistingAppIdLPw(p.appId, p, p.name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p.appId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        PackageManagerService.reportSettingsProblem(Log.WARN,</span><br><span class="line">                <span class="string">"Package "</span> + p.name + <span class="string">" could not be assigned a valid UID"</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> PackageManagerException(INSTALL_FAILED_INSUFFICIENT_STORAGE,</span><br><span class="line">                <span class="string">"Package "</span> + p.name + <span class="string">" could not be assigned a valid UID"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> createdNew;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Returns a new AppID or -1 if we could not find an available AppID to assign */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">acquireAndRegisterNewAppIdLPw</span><span class="params">(SettingBase obj)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Let's be stupidly inefficient for now...</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> size = mAppIds.size();</span><br><span class="line">    <span class="comment">// mFirstAvailableUid下面我会详细解释，这里可以简单理解为最近被卸载的app的uid</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mFirstAvailableUid; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="comment">// 首先看已经分配过的uid中有没有被释放的</span></span><br><span class="line">        <span class="comment">// 找到第一个可用的uid，返回</span></span><br><span class="line">        <span class="keyword">if</span> (mAppIds.get(i) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mAppIds.set(i, obj);</span><br><span class="line">            <span class="comment">// 这里 FIRST_APPLICATION_UID = 10000;</span></span><br><span class="line">            <span class="keyword">return</span> Process.FIRST_APPLICATION_UID + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// None left?</span></span><br><span class="line">    <span class="comment">// 这里LAST_APPLICATION_UID = 19999</span></span><br><span class="line">    <span class="comment">// 所以最多安装9999个app</span></span><br><span class="line">    <span class="keyword">if</span> (size &gt; (Process.LAST_APPLICATION_UID - Process.FIRST_APPLICATION_UID)) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 已经分配的uid中没有被释放的，新分配一个</span></span><br><span class="line">    mAppIds.add(obj);</span><br><span class="line">    <span class="keyword">return</span> Process.FIRST_APPLICATION_UID + size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们解释一下mFirstAvailableUid，Settings中相关代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 每次重启时会重新赋值为0</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> mFirstAvailableUid = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This should be called (at least) whenever an application is removed</span></span><br><span class="line"><span class="comment">// 每次卸载时会被调用</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setFirstAvailableUid</span><span class="params">(<span class="keyword">int</span> uid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (uid &gt; mFirstAvailableUid) &#123;</span><br><span class="line">        mFirstAvailableUid = uid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到mFirstAvailableUid，初始化是0，之后每次有app卸载，对应uid被释放，mFirstAvailableUid就会被赋值为Math.max(mFirstAvailableUid, uid)。所以可以看到上面的循环从mFirstAvailableUid开始是做的一个小优化，希望循环次数少一点。但是也有缺陷，因为在不重启的情况下，mFirstAvailableUid一直是自增的，即使之前有被释放的uid，也访问不到，所以最坏情况就是每次都找不到可复用的uid，每次都分配新的uid，最终uid &gt; 19999，炸了，就不能安装app了。</p>
<h2 id="怎么获取uid"><a href="#怎么获取uid" class="headerlink" title="怎么获取uid"></a>怎么获取uid</h2><ul>
<li>ApplicationInfo.uid</li>
<li>Process.myuid() </li>
</ul>
<h2 id="uid-用来做什么"><a href="#uid-用来做什么" class="headerlink" title="uid 用来做什么"></a>uid 用来做什么</h2><p>权限控制，这里有空详细写一下</p>
<p>参考：<a href="https://www.jianshu.com/p/b33dd49f2ae6" target="_blank" rel="noopener">https://www.jianshu.com/p/b33dd49f2ae6</a></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/07/11/android-uid/" data-id="ckse37dn0001bolj588mrd98c"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/did/" rel="tag">did</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-TEE-kiss" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/11/TEE-kiss/"
    >Android TEE 介绍与使用</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/07/11/TEE-kiss/" class="article-date">
  <time datetime="2021-07-11T09:18:30.000Z" itemprop="datePublished">2021-07-11</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="tee_arch.png" alt=""><br>来源： <a href="https://pdfs.semanticscholar.org/4643/cf6081b98f88736c94220ced13e5ad3569fc.pdf" target="_blank" rel="noopener">https://pdfs.semanticscholar.org/4643/cf6081b98f88736c94220ced13e5ad3569fc.pdf</a></p>
<p><strong>为什么需要TEE</strong></p>
<p>考虑这么一个问题：设备解锁的PIN码和指纹存储在哪里？Linux中，一切都是文件。如果指纹和PIN码存储在Android文件系统里面，只要攻击者获取ROOT权限，就可以读取指纹和PIN码，很不安全。</p>
<p>这种场景就需要TEE了。TEE是一套独立的文件系统，使用的是SoC一块独立的区域，可以理解为Android文件系统和TEE之间相互隔离。因此如果把PIN码和指纹存储在TEE中，Android文件系统是访问不到的，因此安全。</p>
<p>但这也带来了新的问题：</p>
<ul>
<li>PIN码验证和指纹验证是Android在做，Android如何在不能读取PIN码和指纹的情况下做验证？</li>
<li>既然TEE也是个文件系统，黑客可不可以直接开机进入TEE，拿到PIN码和指纹</li>
</ul>
<p>对于第二个问题，笔者无法解答，这里留个TODO。不过<a href="https://www.anquanke.com/post/id/236483#h2-7" target="_blank" rel="noopener">这篇文章</a>介绍了如何在获取Android ROOT权限的情况下攻陷TEE，拿到数据。</p>
<p>对于第一个问题，如上图所示，可以看到Android和TEE之间是有通信渠道的。TEE Kernel会开放有限的入口给Android，Android可以把待验证的指纹和PIN通过接口传到TEE，TEE验证之后返回验证结果。存储在TEE中的数据不会出TEE。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>Android 封装了Keystore类来访问TEE。具体使用可以看<a href="https://developer.android.com/training/articles/keystore" target="_blank" rel="noopener">官网介绍</a>。</p>
<p>官网没讲的是TEE中密钥的持久化，这里介绍一下。</p>
<p>简单说，App在TEE中存储的密钥在App卸载时都会被清楚，除非App是系统应用(具有system uid)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://android.googlesource.com/platform/frameworks/base/+/android-9.0.0_r30/services/core/java/com/android/server/pm/PackageManagerService.java#18570 </span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">     * This method deletes the package from internal data structures. If the DONT_DELETE_DATA</span></span><br><span class="line"><span class="comment">     * flag is not set, the data directory is removed as well.</span></span><br><span class="line"><span class="comment">     * make sure this flag is set for partially installed apps. If not its meaningless to</span></span><br><span class="line"><span class="comment">     * delete a partially installed application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// App 卸载的时候会执行这个函数</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removePackageDataLIF</span><span class="params">(PackageSetting ps, <span class="keyword">int</span>[] allUserHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">            PackageRemovedInfo outInfo, <span class="keyword">int</span> flags, <span class="keyword">boolean</span> writeSettings)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (removedAppId != -<span class="number">1</span>) &#123; </span><br><span class="line">            <span class="comment">// A user ID was deleted here. Go through all users and remove it</span></span><br><span class="line">            <span class="comment">// from KeyStore.</span></span><br><span class="line">            <span class="comment">// 这里清楚tee中的数据</span></span><br><span class="line">            removeKeystoreDataIfNeeded(UserHandle.USER_ALL, removedAppId);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Remove entries from the keystore daemon. Will only remove it if the</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> appId&#125; is valid.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeKeystoreDataIfNeeded</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> appId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (appId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> KeyStore keyStore = KeyStore.getInstance();</span><br><span class="line">        <span class="keyword">if</span> (keyStore != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (userId == UserHandle.USER_ALL) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">final</span> <span class="keyword">int</span> individual : sUserManager.getUserIds()) &#123;</span><br><span class="line">                    keyStore.clearUid(UserHandle.getUid(individual, appId));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                keyStore.clearUid(UserHandle.getUid(userId, appId));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Slog.w(TAG, <span class="string">"Could not contact keystore to clear entries for app id "</span> + appId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://android.googlesource.com/platform/system/security/+/android-9.0.0_r30/keystore/key_store_service.cpp#689</span></span><br><span class="line"><span class="function">Status <span class="title">KeyStoreService::clear_uid</span><span class="params">(<span class="keyword">int64_t</span> targetUid64, <span class="keyword">int32_t</span>* aidl_return)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uid_t</span> targetUid = getEffectiveUid(targetUid64);</span><br><span class="line">    <span class="keyword">if</span> (!checkBinderPermissionSelfOrSystem(P_CLEAR_UID, targetUid)) &#123;</span><br><span class="line">        *aidl_return = <span class="keyword">static_cast</span>&lt;<span class="keyword">int32_t</span>&gt;(ResponseCode::PERMISSION_DENIED);</span><br><span class="line">        <span class="keyword">return</span> Status::ok();</span><br><span class="line">    &#125;</span><br><span class="line">    ALOGI(<span class="string">"clear_uid %"</span> PRId64, targetUid64);</span><br><span class="line">    mKeyStore-&gt;removeAllGrantsToUid(targetUid);</span><br><span class="line">    String8 prefix = String8::format(<span class="string">"%u_"</span>, targetUid);</span><br><span class="line">    Vector&lt;String16&gt; aliases;</span><br><span class="line">    <span class="keyword">if</span> (mKeyStore-&gt;<span class="built_in">list</span>(prefix, &amp;aliases, get_user_id(targetUid)) != ResponseCode::NO_ERROR) &#123;</span><br><span class="line">        *aidl_return = <span class="keyword">static_cast</span>&lt;<span class="keyword">int32_t</span>&gt;(ResponseCode::SYSTEM_ERROR);</span><br><span class="line">        <span class="keyword">return</span> Status::ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里根据aliases删除key</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; aliases.size(); i++) &#123;</span><br><span class="line">        <span class="function">String8 <span class="title">name8</span><span class="params">(aliases[i])</span></span>;</span><br><span class="line">        <span class="function">String8 <span class="title">filename</span><span class="params">(mKeyStore-&gt;getKeyNameForUidWithDir(name8, targetUid, ::TYPE_ANY))</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (get_app_id(targetUid) == AID_SYSTEM) &#123;</span><br><span class="line">            Blob keyBlob;</span><br><span class="line">            ResponseCode responseCode =</span><br><span class="line">                mKeyStore-&gt;get(filename.<span class="built_in">string</span>(), &amp;keyBlob, ::TYPE_ANY, get_user_id(targetUid));</span><br><span class="line">            <span class="keyword">if</span> (responseCode == ResponseCode::NO_ERROR &amp;&amp; keyBlob.isCriticalToDeviceEncryption()) &#123;</span><br><span class="line">                <span class="comment">// Do not clear keys critical to device encryption under system uid.</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mKeyStore-&gt;del(filename.<span class="built_in">string</span>(), ::TYPE_ANY, get_user_id(targetUid));</span><br><span class="line">        <span class="comment">// del() will fail silently if no cached characteristics are present for this alias.</span></span><br><span class="line">        <span class="function">String8 <span class="title">chr_filename</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            mKeyStore-&gt;getKeyNameForUidWithDir(name8, targetUid, ::TYPE_KEY_CHARACTERISTICS))</span></span>;</span><br><span class="line">        mKeyStore-&gt;del(chr_filename.<span class="built_in">string</span>(), ::TYPE_KEY_CHARACTERISTICS, get_user_id(targetUid));</span><br><span class="line">    &#125;</span><br><span class="line">    *aidl_return = <span class="keyword">static_cast</span>&lt;<span class="keyword">int32_t</span>&gt;(ResponseCode::NO_ERROR);</span><br><span class="line">    <span class="keyword">return</span> Status::ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/07/11/TEE-kiss/" data-id="ckse37dmw000tolj59ecdhaep"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TEE/" rel="tag">TEE</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-android-file-format" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/07/android-file-format/"
    >简述Android文件格式</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/07/07/android-file-format/" class="article-date">
  <time datetime="2021-07-07T13:23:53.000Z" itemprop="datePublished">2021-07-07</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>APK, Bundle, DEX, ART, OAT, VDEX, jar, .etc 都是啥格式？</p>
<p>android 加载的类从哪里来的</p>
<p>lineage os的framework层为啥都是空的</p>
<h2 id="APK"><a href="#APK" class="headerlink" title="APK"></a>APK</h2><p>Android 安装包，其实是个压缩文件，把后缀.apk 改成 .zip后解压，目录如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">AndroidManifest.xml </span><br><span class="line">META-INF &#x2F;&#x2F; android签名文件</span><br><span class="line">assets &#x2F;&#x2F; 资源文件</span><br><span class="line">classes.dex &#x2F;&#x2F; java代码</span><br><span class="line">classes1.dex &#x2F;&#x2F; java 代码</span><br><span class="line">classes2.dex &#x2F;&#x2F; java 代码</span><br><span class="line">lib &#x2F;&#x2F; native层so文件</span><br><span class="line">res &#x2F;&#x2F; view相关资源文件</span><br><span class="line">resources.arsc &#x2F;&#x2F; 资源索引文件，由R.layout.main 具体定位到main的路径</span><br></pre></td></tr></table></figure>



<h2 id="Bundle"><a href="#Bundle" class="headerlink" title="Bundle"></a>Bundle</h2><p>Google提出的一种将App上传到Google Play的格式，与APK类似，是一个带有 .aab 扩展名的 zip 文件。对于不使用Google Play做应用分发的开发者来说，并不需要关注这个格式。</p>
<p><strong>Bundle与APK的关系？</strong></p>
<p>Bundle只是上传到Google Play的格式，用户下载的还是APK。由Bundle到APK的这一步由Google Play完成。</p>
<p><strong>为什么提出Bundle格式，有什么好处？</strong></p>
<p>最大的好处是降低apk文件的大小。例如开发者为了兼容碎片化的android设备，会在apk里面加入很多冗余的代码或文件。例如libxxx.so， 通常一个apk中就花包含armeabi, arm64和x86等多种格式，但对具体用户来说，他只会使用一个，其他的都用不上，这些冗余的so文件就会增大apk的体积。</p>
<p>Bundle包含了编译后的源码和资源文件，上传到Google Play之后，用户下载时，Google Play会根据用户设备类型打包bundle文件中对应的资源和代码成apk，下发给用户，可以降低包体积，也可以让开发者做出更多定制化的功能。</p>
<p><a href="https://conorlee.top/2019/03/27/Android-APP-Bundles-Introduction/" target="_blank" rel="noopener">这篇文篇</a>介绍Bundle很清楚。</p>
<h2 id="CLASS"><a href="#CLASS" class="headerlink" title="CLASS"></a>CLASS</h2><p>CLASS是JAVA文件被编译后的格式，也是JVM执行的的文件格式。CLASS是个二进制文件。</p>
<p><img src="class.png" alt=""></p>
<p>mac上可以用xxd -b xxx.class查看class文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">zkding:ttt dingzhenkai$ xxd -b LJ29.class </span><br><span class="line">00000000: 11001010 11111110 10111010 10111110 00000000 00000000  ......</span><br><span class="line">00000006: 00000000 00111000 00000000 00011110 00001010 00000000  .8....</span><br><span class="line">0000000c: 00000101 00000000 00010001 00001001 00000000 00010010  ......</span><br><span class="line">00000012: 00000000 00010011 00001010 00000000 00010100 00000000  ......</span><br><span class="line">00000018: 00010101 00000111 00000000 00010110 00000111 00000000  ......</span><br><span class="line">0000001e: 00010111 00000001 00000000 00000110 00111100 01101001  ....&lt;i</span><br><span class="line">00000024: 01101110 01101001 01110100 00111110 00000001 00000000  nit&gt;..</span><br><span class="line">0000002a: 00000011 00101000 00101001 01010110 00000001 00000000  .()V..</span><br><span class="line">00000030: 00000100 01000011 01101111 01100100 01100101 00000001  .Code.</span><br><span class="line">00000036: 00000000 00001111 01001100 01101001 01101110 01100101  ..Line</span><br><span class="line">0000003c: 01001110 01110101 01101101 01100010 01100101 01110010  Number</span><br><span class="line">00000042: 01010100 01100001 01100010 01101100 01100101 00000001  Table.</span><br><span class="line">00000048: 00000000 00001011 01110011 01110000 01101001 01110010  ..spir</span><br><span class="line">0000004e: 01100001 01101100 01001111 01110010 01100100 01100101  alOrde</span><br><span class="line">00000054: 01110010 00000001 00000000 00000111 00101000 01011011  r...([</span><br><span class="line">0000005a: 01011011 01001001 00101001 01011011 01001001 00000001  [I)[I.</span><br><span class="line">00000060: 00000000 00001101 01010011 01110100 01100001 01100011  ..Stac</span><br><span class="line">00000066: 01101011 01001101 01100001 01110000 01010100 01100001  kMapTa</span><br></pre></td></tr></table></figure>

<h2 id="JAR"><a href="#JAR" class="headerlink" title="JAR"></a>JAR</h2><p>.class集合</p>
<h2 id="DEX"><a href="#DEX" class="headerlink" title="DEX"></a>DEX</h2><p>.class集合</p>
<p>在Android平台上，当java程序编译成class后，使用dx工具将所有的class文件整合到一个dex文件，目的是其中各个类能够共享数据，在一定程度上降低了冗余，同时也是文件结构更加经凑，dex文件是传统jar文件大小的50%左右。</p>
<h2 id="VDEX"><a href="#VDEX" class="headerlink" title="VDEX"></a>VDEX</h2><p>google在android8.0新增加了vdex文件，其中包含 APK 的未压缩 DEX 代码，另外还有一些旨在加快验证速度的元数据。</p>
<p>VDEX 文件有助于提升软件更新的性能和用户体验。VDEX 文件会存储包含验证程序依赖项且经过预验证的 DEX 文件，以便 ART 在系统更新期间无需再次解压和验证 DEX 文件。无需执行任何操作，即可实现该功能。该功能默认处于启用状态。要停用该功能，请将 ART_ENABLE_VDEX 环境变量设为 false。</p>
<h2 id="ODEX"><a href="#ODEX" class="headerlink" title="ODEX"></a>ODEX</h2><p>全名Optimized DEX，即优化过的DEX。<br>Apk在安装(installer)时，就会进行验证和优化，目的是为了校验代码合法性及优化代码执行速度，验证和优化后，会产生ODEX文件，运行Apk的时候，直接加载ODEX，避免重复验证和优化，加快了Apk的响应时间。</p>
<p>注意：优化过程会根据不同设备上Dalvik虚拟机的版本、Framework库的不同等因素而不同。在一台设备上被优化过的ODEX文件，拷贝到另一台设备上不一定能够运行。</p>
<h2 id="ART"><a href="#ART" class="headerlink" title="ART"></a>ART</h2><p>.art是一些类/filed/方法，app启动直接map到内存，从odex中拆分出来的,art文件主要为了加快应用的对“热代码”的加载与缓存</p>
<h2 id="OAT"><a href="#OAT" class="headerlink" title="OAT"></a>OAT</h2><p>oat 文件是 ART 运行的文件，是一种ELF格式的二进制可运行文件，包含 DEX 文件和编译出的本地机器指令文件。因为 oat 文件包含 DEX 文件，因此比 ODEX 文件占用空间更大。</p>
<p>由于其在安装时打包在里面的classes.dex文件会被工具dex2oat翻译成本地机器指令，最终得到一个ELF格式的OAT文件，ART 加载 OAT 文件后不需要经过处理就可以直接运行，它没有了从字节码装换成机器码的过程，因此运行速度更快。</p>
<p><img src="https://img-blog.csdnimg.cn/20191021092126228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2pvaG5XY2hldW5n,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="Android-mk-Android-bp"><a href="#Android-mk-Android-bp" class="headerlink" title="Android.mk Android.bp"></a>Android.mk Android.bp</h2><p>参考：<a href="https://blog.csdn.net/johnWcheung/article/details/102657024" target="_blank" rel="noopener">https://blog.csdn.net/johnWcheung/article/details/102657024</a></p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/07/07/android-file-format/" data-id="ckse37dmz0015olj5fiy8fp91"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" rel="tag">文件格式</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-lineageos-build" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/06/lineageos-build/"
    >编译lineageOS过程中的注意点</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/07/06/lineageos-build/" class="article-date">
  <time datetime="2021-07-06T14:36:38.000Z" itemprop="datePublished">2021-07-06</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>本文记录根据<a href="https://wiki.lineageos.org/devices/sagit/build" target="_blank" rel="noopener">官网教程</a>编译lineageos时遇到的一些坑。</p>
<h2 id="下载时用清华源"><a href="#下载时用清华源" class="headerlink" title="下载时用清华源"></a>下载时用清华源</h2><p>repo init时需要首先下载repo命令的包</p>
<p>repo init -u <a href="https://github.com/LineageOS/android.git" target="_blank" rel="noopener">https://github.com/LineageOS/android.git</a> -b lineage-15.1 </p>
<p>repo sync下载lineage os源码是也使用清华源，<a href="https://mirror.tuna.tsinghua.edu.cn/help/lineageOS/" target="_blank" rel="noopener">参考</a></p>
<p>注意同步源码时使用命令 repo sync -c -j8</p>
<h2 id="提取vendor"><a href="#提取vendor" class="headerlink" title="提取vendor"></a>提取vendor</h2><p><a href="https://wiki.lineageos.org/extracting_blobs_from_zips.html" target="_blank" rel="noopener">官网</a>提供了两种方式，一种是从真机中提取，另一种是从安装包中提取。建议用后者，这里需要找到一个靠谱的安装包，我当时想找的是lineageos 15.1的版本，这个版本官网已经下架了(似乎是官网没有很多钱支付带宽和存储)，所以去网上下载的，好几个包都没用。。。</p>
<h2 id="编译报错"><a href="#编译报错" class="headerlink" title="编译报错"></a>编译报错</h2><p><strong>Communication error with Jack server (35), try ‘jack-diagnose’ or see Jack server log</strong></p>
<p>jack server 通信问题，<a href="https://hex.ro/wp/blog/communication-error-with-jack-server-35-try-jack-diagnose-or-see-jack-server-log/" target="_blank" rel="noopener">参考</a></p>
<p>需要重启jack server</p>
<h2 id="刷机报错"><a href="#刷机报错" class="headerlink" title="刷机报错"></a>刷机报错</h2><p>刷机步骤:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash recovery recovery.img</span><br><span class="line">fastboot boot recovery.img</span><br><span class="line">adb sideload lineageos.zip</span><br></pre></td></tr></table></figure>

<p><strong>assert(xiaomi.verify_trustzone(“TZ.BF.4.0.6-00124”, “xxxxx”) == “1”) failed</strong></p>
<p>解压编译出的zip文件，在META-INF\com\google\android\updater-script 中删掉第二行assert，然后重新压缩为zip即可刷入</p>
<h2 id="使用过程中的报错"><a href="#使用过程中的报错" class="headerlink" title="使用过程中的报错"></a>使用过程中的报错</h2><p><strong>网络已连接但是不能访问</strong></p>
<p>其实不是真的不能联网。lineageos通过访问Google来验证网络连接，国内自然连不了Google。试试baidu应该就可以访问。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://gitpress.io/@drinko/%E7%BC%96%E8%AF%91%E7%AC%94%E8%AE%B0" target="_blank" rel="noopener">https://gitpress.io/@drinko/%E7%BC%96%E8%AF%91%E7%AC%94%E8%AE%B0</a></li>
<li><a href="https://www.jianshu.com/p/19cb9c08ee51" target="_blank" rel="noopener">https://www.jianshu.com/p/19cb9c08ee51</a></li>
<li><a href="https://hex.ro/wp/blog/communication-error-with-jack-server-35-try-jack-diagnose-or-see-jack-server-log/" target="_blank" rel="noopener">https://hex.ro/wp/blog/communication-error-with-jack-server-35-try-jack-diagnose-or-see-jack-server-log/</a></li>
</ol>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/07/06/lineageos-build/" data-id="ckse37dn90026olj5do1udt5k"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lineages/" rel="tag">lineages</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-nexus-flush-rom" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/29/nexus-flush-rom/"
    >刷机(nexus、samsung、xiaomi)</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/06/29/nexus-flush-rom/" class="article-date">
  <time datetime="2021-06-29T11:40:26.000Z" itemprop="datePublished">2021-06-29</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%88%B7%E6%9C%BA/">刷机</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Nexus"><a href="#Nexus" class="headerlink" title="Nexus"></a>Nexus</h2><h3 id="刷入CM"><a href="#刷入CM" class="headerlink" title="刷入CM"></a>刷入CM</h3><p>我这里记录的是Nexus 7（flo）刷入<a href="https://twrp.me/asus/asusnexus72013wifi.html" target="_blank" rel="noopener">TWRP</a> 跟 <a href="http://androidhost.org/uYlcI" target="_blank" rel="noopener">CM13(Android 6.0)</a> 的步骤（注：下载时如果速度太慢，五个多小时那样，把有线网切换为wifi下载）。  </p>
<ol>
<li>刷入CM（adb push CM.zip sdcard/）<br>注：adb push/pull 如果显示”remote do not exists” 一般是权限不对 可以先 adb root， adb remount一下，然后再adb push， 如果还不行，就改一下sdcard的权限（chmod 777 sdcard， chmod 777 -R sdcard），如果还不行，请Google。</li>
<li>关机。  </li>
<li>同时按住电源键与音量减键进入bootloader模式。  </li>
<li>解锁（fastboot oem unlock）</li>
<li>刷入TWRP（fastboot flash recovery xxx.img），然后进入Recovery Mode（fastboot boot xxx.img）<br>注：windows上使用fastboot需要装<a href="https://developer.android.com/studio/run/win-usb.html" target="_blank" rel="noopener">驱动</a><br>   如果您刷了Twrp后进入recovery mode后机子一直显示的是启动的画面（中间是Google 下面是一把锁，那可能是因为你刷入的Twrp不符合你的手机类型，您需要找到对应你手机的Twrp版本，重新刷入（即回到第一步）</li>
<li>wipe。</li>
<li>install CM.zip</li>
</ol>
<h3 id="刷入官方镜像"><a href="#刷入官方镜像" class="headerlink" title="刷入官方镜像"></a>刷入官方镜像</h3><p>下载<a href="https://developers.google.com/android/images" target="_blank" rel="noopener">官方镜像</a>，解压运行脚本。这是<a href="https://blog.csdn.net/u012417380/article/details/72843185" target="_blank" rel="noopener">参考</a></p>
<h2 id="Samsung"><a href="#Samsung" class="headerlink" title="Samsung"></a>Samsung</h2><p>用odin刷入官方固件</p>
<h2 id="Xiaomi"><a href="#Xiaomi" class="headerlink" title="Xiaomi"></a>Xiaomi</h2><p>小米刷机有两种方式，其一类似三星提供了odin傻瓜式刷机，小米也提供了<a href="https://www.miui.com/shuaji-393.html" target="_blank" rel="noopener">MiFlush</a>来傻瓜式刷机；其二就是先刷recovery再卡刷rom，与nexus类似。</p>
<h2 id="救砖"><a href="#救砖" class="headerlink" title="救砖"></a>救砖</h2><p>用线刷大师救砖</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/06/29/nexus-flush-rom/" data-id="ckse37dnc002jolj59dwagszn"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%B7%E6%9C%BA/" rel="tag">刷机</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Android-JS-Debug" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/06/28/Android-JS-Debug/"
    >动态调试Android Webview中的JS</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/06/28/Android-JS-Debug/" class="article-date">
  <time datetime="2021-06-28T14:23:58.000Z" itemprop="datePublished">2021-06-28</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a> / <a class="article-category-link" href="/categories/Android/H5/">H5</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>Chrome提供了动态调试Webview中JS的功能，这里记录一下步骤。</p>
<h2 id="1-配置Demo-APK"><a href="#1-配置Demo-APK" class="headerlink" title="1. 配置Demo APK"></a>1. 配置Demo APK</h2><p>这里首先需要测试手机/平板/模拟器开启adb 调试。</p>
<ul>
<li><p>给apk加上网络访问权限</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加webview控件，并配置调试相关属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setJavaScriptEnabled(<span class="keyword">true</span>); <span class="comment">// 允许webview执行JS</span></span><br><span class="line">setWebContentsDebuggingEnabled(<span class="keyword">true</span>); <span class="comment">// 允许调试</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>webview load js</p>
<p>load js有两种方式，其一js文件放在本地，然后webview使用file协议读取(需要setAllowFileAccess(true))，其二是js放在远端，webview使用http/https协议读取。建议用本地读取的方式，因为远端调试的话，Android 9 (api level 28)开始就禁用http协议，而使用https需要申请证书，很麻烦。</p>
</li>
<li><p>打开app</p>
</li>
</ul>
<h2 id="2-使用Chrome-进行调试"><a href="#2-使用Chrome-进行调试" class="headerlink" title="2. 使用Chrome 进行调试"></a>2. 使用Chrome 进行调试</h2><p>chrome 访问 chrome://inspect/#devices</p>
<p><img src="1.png" alt=""></p>
<p>点击inspect即可进入调试window</p>
<p><img src="2.png" alt=""></p>
<p>之后就可以愉快的调试了</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zkdingme.github.io/2021/06/28/Android-JS-Debug/" data-id="ckse37dmb0001olj567t2hu7p"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebView/" rel="tag">WebView</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020-2021
        Bonjour Ding
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <ul class="list-inline">
  <li>PV:<span id="busuanzi_value_page_pv"></span></li>
  <li>UV:<span id="busuanzi_value_site_uv"></span></li>
</ul>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/favicon.ico" alt="丁星乐"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/01/31/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>
<script>
  var typed = new Typed("#subtitle", {
    strings: ['芒焰藏于简单之中','江山如此多娇','会当击水三千里，自信人生二百年'],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
</script>




<script>
  var ayerConfig = {
    mathjax: true
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>